import * as tslib_1 from "tslib";
import { ChangeDetectionStrategy, Component, ElementRef, EventEmitter, Inject, Input, Output, Renderer2, ViewChild, } from '@angular/core';
import { FormBuilder, FormControl, Validators } from '@angular/forms';
import { BehaviorSubject } from 'rxjs';
import { map } from 'rxjs/operators';
import { EMPTY_COLOR, coerceHexaColor, isValidColor } from './color-picker';
var MccColorPickerSelectorComponent = /** @class */ (function () {
    function MccColorPickerSelectorComponent(formBuilder, render, emptyColor) {
        this.formBuilder = formBuilder;
        this.render = render;
        this.emptyColor = emptyColor;
        this._height = 170;
        this._selectedColor = '';
        this._hideHexForms = false;
        /**
         * Emit update when a color is selected
         */
        this.changeSelectedColor = new EventEmitter();
        /**
         * RGBA current color
         */
        this._rgbaColor = 'rgba(255,0,0,1)';
        /**
         * Handle color of the text
         */
        this.textClass = 'black';
        /**
         * Validate if the mouse button is pressed
         */
        this._isPressed = false;
        /**
         * Form and keys of the fields in RGB
         */
        this.rgbKeys = ['R', 'G', 'B'];
    }
    Object.defineProperty(MccColorPickerSelectorComponent.prototype, "blockCursor", {
        /**
         * Canvas of the block
         */
        set: function (el) {
            this._bc = el;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MccColorPickerSelectorComponent.prototype, "stripCursor", {
        /**
         * Container of the strip
         */
        set: function (el) {
            this._sc = el;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MccColorPickerSelectorComponent.prototype, "height", {
        /**
         * Change height base of the selector
         */
        set: function (value) {
            this._height = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MccColorPickerSelectorComponent.prototype, "selectorHeight", {
        get: function () {
            return this._height;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MccColorPickerSelectorComponent.prototype, "stripHeight", {
        get: function () {
            return this._height - 10;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MccColorPickerSelectorComponent.prototype, "selectedColor", {
        /**
         * Receive selected color from the component
         */
        get: function () {
            return this._selectedColor;
        },
        set: function (value) {
            this._selectedColor = value || this.emptyColor;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MccColorPickerSelectorComponent.prototype, "hideHexForms", {
        /**
         * Hide the hexadecimal color forms.
         */
        get: function () {
            return this._hideHexForms;
        },
        set: function (value) {
            this._hideHexForms = value;
        },
        enumerable: true,
        configurable: true
    });
    MccColorPickerSelectorComponent.prototype.ngOnInit = function () {
        var _this = this;
        this._tmpSelectedColor = new BehaviorSubject(this._selectedColor);
        this._tmpSelectedColorSub = this._tmpSelectedColor.subscribe(function (color) {
            if (color !== _this._selectedColor && isValidColor(color)) {
                if (_this.hexForm.get('hexCode').value !== color) {
                    _this.hexForm.setValue({ hexCode: color });
                }
                _this.changeSelectedColor.emit(coerceHexaColor(color) || _this.emptyColor);
            }
        });
        // hex form
        this.hexForm = this.formBuilder.group({
            hexCode: [this.selectedColor, [Validators.minLength(7), Validators.maxLength(7)]],
        });
        // rgb dynamic form
        var rgbGroup = {};
        var rgbValue = this._getRGB();
        this.rgbKeys.forEach(function (key, index) {
            return (rgbGroup[key] = new FormControl(rgbValue[index], {
                validators: [
                    Validators.min(0),
                    Validators.max(256),
                    Validators.required,
                    Validators.maxLength(3),
                ],
                updateOn: 'blur',
            }));
        });
        this.rgbForm = this.formBuilder.group(rgbGroup);
        // watch changes on forms
        this._onChanges();
    };
    /**
     * Update RGB, RGBA and Gradient when selectedColor change and
     * the mouse button is pressed
     * @param changes SimpleChanges
     */
    MccColorPickerSelectorComponent.prototype.ngOnChanges = function (changes) {
        if ('selectedColor' in changes && changes['selectedColor'].currentValue !== this.emptyColor) {
            if (!this._isPressed) {
                this._updateRGB();
                this._updateRGBA();
                if (this._blockContext) {
                    this._fillGradient();
                }
            }
            var rgb = this._getRGB();
            var o = Math.round((rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000);
            this.textClass = o > 125 ? 'black' : 'white';
        }
    };
    /**
     * Destroy all subscriptions
     */
    MccColorPickerSelectorComponent.prototype.ngOnDestroy = function () {
        if (this._tmpSelectedColorSub && !this._tmpSelectedColorSub.closed) {
            this._tmpSelectedColorSub.unsubscribe();
        }
        if (this._hexValuesSub && !this._hexValuesSub.closed) {
            this._hexValuesSub.unsubscribe();
        }
        if (this._rgbValuesSub && !this._rgbValuesSub.closed) {
            this._rgbValuesSub.unsubscribe();
        }
    };
    MccColorPickerSelectorComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        this.render.listen(this._block.nativeElement, 'mousedown', function (e) {
            _this._isPressed = true;
            _this.changeColor(e);
        });
        this.render.listen(this._block.nativeElement, 'mouseup', function () { return (_this._isPressed = false); });
        this.render.listen(this._block.nativeElement, 'mouseout', function () { return (_this._isPressed = false); });
        this.render.listen(this._block.nativeElement, 'mousemove', function (e) { return _this.changeColor(e); });
        this._blockContext = this._bc.nativeElement.getContext('2d');
        this._blockContext.rect(0, 0, this._bc.nativeElement.width, this._bc.nativeElement.height);
        this.render.listen(this._strip.nativeElement, 'mousedown', function (e) {
            _this._isPressed = true;
            _this.changeBaseColor(e);
        });
        this.render.listen(this._strip.nativeElement, 'mouseup', function () { return (_this._isPressed = false); });
        this.render.listen(this._strip.nativeElement, 'mouseout', function () { return (_this._isPressed = false); });
        this.render.listen(this._strip.nativeElement, 'mousemove', function (e) { return _this.changeBaseColor(e); });
        this._stripContext = this._strip.nativeElement.getContext('2d');
        this._stripContext.rect(0, 0, this._strip.nativeElement.width, this._strip.nativeElement.height);
        var grd1 = this._stripContext.createLinearGradient(0, 0, 0, this._bc.nativeElement.height);
        grd1.addColorStop(0, 'rgba(255, 0, 0, 1)');
        grd1.addColorStop(0.17, 'rgba(255, 255, 0, 1)');
        grd1.addColorStop(0.34, 'rgba(0, 255, 0, 1)');
        grd1.addColorStop(0.51, 'rgba(0, 255, 255, 1)');
        grd1.addColorStop(0.68, 'rgba(0, 0, 255, 1)');
        grd1.addColorStop(0.85, 'rgba(255, 0, 255, 1)');
        grd1.addColorStop(1, 'rgba(255, 0, 0, 1)');
        this._stripContext.fillStyle = grd1;
        this._stripContext.fill();
        this._fillGradient();
    };
    /**
     * Generate colors based on the RGBA color
     */
    MccColorPickerSelectorComponent.prototype._fillGradient = function () {
        this._blockContext.fillStyle = this._rgbaColor;
        this._blockContext.fillRect(0, 0, this._bc.nativeElement.width, this._bc.nativeElement.height);
        var grdWhite = this._stripContext.createLinearGradient(0, 0, this._bc.nativeElement.width, 0);
        grdWhite.addColorStop(0, 'rgba(255,255,255,1)');
        grdWhite.addColorStop(1, 'rgba(255,255,255,0)');
        this._blockContext.fillStyle = grdWhite;
        this._blockContext.fillRect(0, 0, this._bc.nativeElement.width, this._bc.nativeElement.height);
        var grdBlack = this._stripContext.createLinearGradient(0, 0, 0, this._bc.nativeElement.height);
        grdBlack.addColorStop(0, 'rgba(0,0,0,0)');
        grdBlack.addColorStop(1, 'rgba(0,0,0,1)');
        this._blockContext.fillStyle = grdBlack;
        this._blockContext.fillRect(0, 0, this._bc.nativeElement.width, this._bc.nativeElement.height);
    };
    /**
     * Watch change on forms
     */
    MccColorPickerSelectorComponent.prototype._onChanges = function () {
        var _this = this;
        // validate digited code and update when digitation is finished
        this._hexValuesSub = this.hexForm.get('hexCode').valueChanges
            .pipe(map(function (color) { return color !== _this.emptyColor ? coerceHexaColor(color) : color; }))
            .subscribe(function (value) {
            if (!_this._isPressed && isValidColor(value)) {
                _this._tmpSelectedColor.next(value || _this.emptyColor);
            }
        });
        this._rgbValuesSub = this.rgbForm.valueChanges.subscribe(function (controls) {
            var data = [];
            for (var key in controls) {
                if (!controls[key] && controls[key] !== 0 || controls[key] > 255) {
                    data.push('');
                    continue;
                }
                data.push(controls[key]);
            }
            var hex = _this._getHex(data);
            if (hex !== _this._selectedColor && hex.length === 7) {
                _this._tmpSelectedColor.next(hex);
            }
        });
    };
    /**
     * Convert HEX/canvas value to rgb
     * @param data any
     * @returns number[]
     */
    MccColorPickerSelectorComponent.prototype._getRGB = function (data) {
        if (data) {
            return [data[0], data[1], data[2]];
        }
        var hex = this._selectedColor.replace('#', '');
        var r = parseInt(hex.slice(0, 2), 16);
        var g = parseInt(hex.slice(2, 4), 16);
        var b = parseInt(hex.slice(4, 6), 16);
        return [r, g, b];
    };
    /**
     * Convert RGB value to HEX
     * @param data any
     * @returns string
     */
    MccColorPickerSelectorComponent.prototype._getHex = function (data) {
        var hex = new Array(3);
        hex[0] = data[0].toString(16);
        hex[1] = data[1].toString(16);
        hex[2] = data[2].toString(16);
        hex.forEach(function (val, key) {
            if (val.length === 1) {
                hex[key] = '0' + hex[key];
            }
        });
        return coerceHexaColor("" + hex[0] + hex[1] + hex[2]) || this.emptyColor;
    };
    /**
     * Update RGBA color
     * @param data any
     */
    MccColorPickerSelectorComponent.prototype._updateRGBA = function (data) {
        if (!this._selectedColor && !data) {
            this._rgbaColor = 'rgba(255,0,0,1)';
        }
        var rgb = this._getRGB(data);
        this._rgbaColor = "rgba(" + rgb[0] + ", " + rgb[1] + ", " + rgb[2] + ", 1)";
    };
    /**
     * Update RGB form
     * @param data any
     */
    MccColorPickerSelectorComponent.prototype._updateRGB = function (data) {
        if (!this.rgbForm) {
            return;
        }
        if (!data) {
            data = this._getRGB();
        }
        this.rgbForm.setValue({ R: data[0], G: data[1], B: data[2] });
    };
    /**
     * Get selected base color from the canvas
     * @param e MouseEvent
     */
    MccColorPickerSelectorComponent.prototype.changeBaseColor = function (e) {
        if (this._isPressed) {
            this.render.setStyle(this._sc.nativeElement, 'background-position-y', e.offsetY + "px");
            var data = this._stripContext.getImageData(e.offsetX, e.offsetY, 1, 1).data;
            this._updateRGBA(data);
            this._fillGradient();
            this.updateValues(data);
        }
    };
    /**
     * Get selected color from the canvas
     * @param e MouseEvent
     */
    MccColorPickerSelectorComponent.prototype.changeColor = function (e) {
        if (this._isPressed) {
            this.render.setStyle(this._bp.nativeElement, 'top', e.offsetY - 5 + "px");
            this.render.setStyle(this._bp.nativeElement, 'left', e.offsetX - 5 + "px");
            var data = this._blockContext.getImageData(e.offsetX, e.offsetY, 1, 1).data;
            this.updateValues(data);
        }
    };
    /**
     * Emit update from the selected color
     * @param data any
     */
    MccColorPickerSelectorComponent.prototype.updateValues = function (data) {
        if (data) {
            this._updateRGB(data);
            this._tmpSelectedColor.next(this._getHex(data));
        }
    };
    tslib_1.__decorate([
        ViewChild('block', { static: false }),
        tslib_1.__metadata("design:type", ElementRef)
    ], MccColorPickerSelectorComponent.prototype, "_block", void 0);
    tslib_1.__decorate([
        ViewChild('blockPointer', { static: false }),
        tslib_1.__metadata("design:type", ElementRef)
    ], MccColorPickerSelectorComponent.prototype, "_bp", void 0);
    tslib_1.__decorate([
        ViewChild('blockCanvas', { static: false }),
        tslib_1.__metadata("design:type", ElementRef),
        tslib_1.__metadata("design:paramtypes", [ElementRef])
    ], MccColorPickerSelectorComponent.prototype, "blockCursor", null);
    tslib_1.__decorate([
        ViewChild('strip', { static: false }),
        tslib_1.__metadata("design:type", ElementRef)
    ], MccColorPickerSelectorComponent.prototype, "_strip", void 0);
    tslib_1.__decorate([
        ViewChild('stripContainer', { static: false }),
        tslib_1.__metadata("design:type", ElementRef),
        tslib_1.__metadata("design:paramtypes", [ElementRef])
    ], MccColorPickerSelectorComponent.prototype, "stripCursor", null);
    tslib_1.__decorate([
        Input('height'),
        tslib_1.__metadata("design:type", Number),
        tslib_1.__metadata("design:paramtypes", [Number])
    ], MccColorPickerSelectorComponent.prototype, "height", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], MccColorPickerSelectorComponent.prototype, "selectedColor", null);
    tslib_1.__decorate([
        Input('hideHexForms'),
        tslib_1.__metadata("design:type", Boolean),
        tslib_1.__metadata("design:paramtypes", [Boolean])
    ], MccColorPickerSelectorComponent.prototype, "hideHexForms", null);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], MccColorPickerSelectorComponent.prototype, "changeSelectedColor", void 0);
    MccColorPickerSelectorComponent = tslib_1.__decorate([
        Component({
            selector: 'mcc-color-picker-selector',
            template: "<div class=\"mcc-color-picker-selector\" [ngStyle]=\"{ 'height.px': selectorHeight }\">\n    <div #block class=\"mcc-picker-selector\"></div>\n    <canvas #blockCanvas [height]=\"selectorHeight\" width=\"230\" id=\"picker\"></canvas>\n    <div #blockPointer class=\"mcc-picker-position\" style=\"top: 0px;left: 220px;\"></div>\n\n    <div #stripContainer class=\"mcc-colors-position\" style=\"background-position-y: 0px;\">\n        <canvas #strip [height]=\"stripHeight\" width=\"20\" id=\"colors\"></canvas>\n    </div>\n</div>\n\n<div class=\"mcc-color-picker-selector-preview\" [style.background]=\"selectedColor\">\n    <ng-container *ngIf=\"!hideHexForms\">\n        <form [formGroup]=\"hexForm\">\n            <mat-form-field class=\"hex-input\" floatLabel=\"always\" [ngClass]=\"textClass\">\n                <input matInput placeholder=\"HEX\" maxlength=\"7\" formControlName=\"hexCode\" [value]=\"selectedColor\" />\n            </mat-form-field>\n        </form>\n\n        <form [formGroup]=\"rgbForm\">\n            <mat-form-field class=\"rgb-input\" floatLabel=\"always\" [ngClass]=\"textClass\">\n                <input matInput type=\"number\" placeholder=\"RGB\" maxlength=\"3\" formControlName=\"R\" />\n            </mat-form-field>\n            <mat-form-field class=\"rgb-input\" floatLabel=\"always\" [ngClass]=\"textClass\">\n                <input matInput type=\"number\" maxlength=\"3\" formControlName=\"G\" />\n            </mat-form-field>\n            <mat-form-field class=\"rgb-input\" floatLabel=\"always\" [ngClass]=\"textClass\">\n                <input matInput type=\"number\" maxlength=\"3\" formControlName=\"B\" />\n            </mat-form-field>\n        </form>\n    </ng-container>\n</div>",
            preserveWhitespaces: false,
            changeDetection: ChangeDetectionStrategy.OnPush,
            styles: ["canvas#colors{margin:5px}canvas:hover{cursor:crosshair}.mcc-picker-selector{position:absolute;width:230px;height:170px;top:0;left:0;z-index:10;cursor:crosshair}.mcc-picker-position{position:absolute;width:10px;height:10px;z-index:1;border:1px solid #ddd;border-radius:50%;background:rgba(0,0,0,.3)}.mcc-colors-position{position:absolute;width:30px;height:160px;top:0;right:0;z-index:1;background:url(data:image/gif;base64,R0lGODdhHgAIALMAAAAAADU1NTk5OUJCQkpKSlZWVltbW2pqaoCAgP///wAAAAAAAAAAAAAAAAAAAAAAACH5BAkAAAoALAAAAAAeAAgAAAQw0BhFq734yjJm/p8xFEVAeGCqGERACmahgkUrvPH81cFdnjoQy8VBBTOiguSokkQAADs=) no-repeat}.mcc-color-picker-selector{height:170px}::ng-deep mat-form-field{font-family:'Open Sans';font-size:11px;font-weight:700}::ng-deep mat-form-field.black{color:#100214}::ng-deep mat-form-field.black label{color:#100214}::ng-deep mat-form-field.black .mat-form-field-underline{background-color:#100214}::ng-deep mat-form-field.white{color:#fff}::ng-deep mat-form-field.white label{color:#fff}::ng-deep mat-form-field.white .mat-form-field-underline{background-color:#fff}.mcc-color-picker-selector-preview{height:40px;padding:15px;border-bottom:1px solid #e1e1e1;box-sizing:content-box}.mcc-color-picker-selector-preview form{display:inline-block;position:relative}.mcc-color-picker-selector-preview .hex-input{width:75px;margin-right:20px}.mcc-color-picker-selector-preview .hex-input input{font-size:16px;font-weight:400}.mcc-color-picker-selector-preview .rgb-input{width:40px;margin-right:5px}.mcc-color-picker-selector-preview .rgb-input input{font-size:16px;font-weight:400}"]
        }),
        tslib_1.__param(2, Inject(EMPTY_COLOR)),
        tslib_1.__metadata("design:paramtypes", [FormBuilder,
            Renderer2, String])
    ], MccColorPickerSelectorComponent);
    return MccColorPickerSelectorComponent;
}());
export { MccColorPickerSelectorComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3ItcGlja2VyLXNlbGVjdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL21hdGVyaWFsLWNvbW11bml0eS1jb21wb25lbnRzLyIsInNvdXJjZXMiOlsiY29sb3ItcGlja2VyL2NvbG9yLXBpY2tlci1zZWxlY3Rvci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFFTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssRUFJTCxNQUFNLEVBQ04sU0FBUyxFQUVULFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBYSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqRixPQUFPLEVBQUUsZUFBZSxFQUFnQixNQUFNLE1BQU0sQ0FBQztBQUNyRCxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDckMsT0FBTyxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFjNUU7SUFnSUUseUNBQ1UsV0FBd0IsRUFDeEIsTUFBaUIsRUFDSSxVQUFrQjtRQUZ2QyxnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUN4QixXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQ0ksZUFBVSxHQUFWLFVBQVUsQ0FBUTtRQWhGekMsWUFBTyxHQUFXLEdBQUcsQ0FBQztRQVl0QixtQkFBYyxHQUFXLEVBQUUsQ0FBQztRQVk1QixrQkFBYSxHQUFZLEtBQUssQ0FBQztRQUV2Qzs7V0FFRztRQUNPLHdCQUFtQixHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFbkQ7O1dBRUc7UUFDSyxlQUFVLEdBQVcsaUJBQWlCLENBQUM7UUFzQi9DOztXQUVHO1FBQ0gsY0FBUyxHQUFXLE9BQU8sQ0FBQztRQUU1Qjs7V0FFRztRQUNILGVBQVUsR0FBWSxLQUFLLENBQUM7UUFP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LFNBQVMsQ0FBQyxPQUFPLEVBQUUsRUFBQyxNQUFNLEVBQUUsS0FBSyxFQUFDLENBQUM7MENBQVMsVUFBVTttRUFBQztJQVF4RDtRQURDLFNBQVMsQ0FBQyxnQkFBZ0IsRUFBRSxFQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUMsQ0FBQzswQ0FDekIsVUFBVTtpREFBVixVQUFVO3NFQUU3QjtJQU9EO1FBREMsS0FBSyxDQUFDLFFBQVEsQ0FBQzs7O2lFQUdmO0lBYUQ7UUFEQyxLQUFLLEVBQUU7Ozt3RUFHUDtJQVVEO1FBREMsS0FBSyxDQUFDLGNBQWMsQ0FBQzs7O3VFQUdyQjtJQVNTO1FBQVQsTUFBTSxFQUFFOztnRkFBMEM7SUFoRnhDLCtCQUErQjtRQVAzQyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsMkJBQTJCO1lBQ3JDLGd0REFBcUQ7WUFFckQsbUJBQW1CLEVBQUUsS0FBSztZQUMxQixlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTs7U0FDaEQsQ0FBQztRQW9JRyxtQkFBQSxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUE7aURBRkMsV0FBVztZQUNoQixTQUFTO09BbEloQiwrQkFBK0IsQ0FzWjNDO0lBQUQsc0NBQUM7Q0FBQSxBQXRaRCxJQXNaQztTQXRaWSwrQkFBK0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEluamVjdCxcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgUmVuZGVyZXIyLFxuICBTaW1wbGVDaGFuZ2VzLFxuICBWaWV3Q2hpbGQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybUJ1aWxkZXIsIEZvcm1Db250cm9sLCBGb3JtR3JvdXAsIFZhbGlkYXRvcnMgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgRU1QVFlfQ09MT1IsIGNvZXJjZUhleGFDb2xvciwgaXNWYWxpZENvbG9yIH0gZnJvbSAnLi9jb2xvci1waWNrZXInO1xuXG5pbnRlcmZhY2UgQ29sb3JPcHRpb24ge1xuICB0eXBlOiBzdHJpbmc7XG4gIHZhbHVlOiBudW1iZXI7XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ21jYy1jb2xvci1waWNrZXItc2VsZWN0b3InLFxuICB0ZW1wbGF0ZVVybDogJy4vY29sb3ItcGlja2VyLXNlbGVjdG9yLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vY29sb3ItcGlja2VyLXNlbGVjdG9yLmNvbXBvbmVudC5zY3NzJ10sXG4gIHByZXNlcnZlV2hpdGVzcGFjZXM6IGZhbHNlLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgTWNjQ29sb3JQaWNrZXJTZWxlY3RvckNvbXBvbmVudFxuICBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuICAvKipcbiAgICogRWxlbWVuUmVmIG9mIHRoZSBtYWluIGNvbG9yXG4gICAqL1xuICAgQFZpZXdDaGlsZCgnYmxvY2snLCB7c3RhdGljOiBmYWxzZX0pIF9ibG9jazogRWxlbWVudFJlZjtcblxuICAvKipcbiAgICogRWxlbWVuUmVmIG9mIHRoZSBwb2ludGVyIG1haW4gY29sb3JcbiAgICovXG4gIEBWaWV3Q2hpbGQoJ2Jsb2NrUG9pbnRlcicsIHtzdGF0aWM6IGZhbHNlfSkgX2JwOiBFbGVtZW50UmVmO1xuXG4gIC8qKlxuICAgKiBDYW52YXMgb2YgdGhlIGJsb2NrXG4gICAqL1xuICBAVmlld0NoaWxkKCdibG9ja0NhbnZhcycsIHtzdGF0aWM6IGZhbHNlfSlcbiAgc2V0IGJsb2NrQ3Vyc29yKGVsOiBFbGVtZW50UmVmKSB7XG4gICAgdGhpcy5fYmMgPSBlbDtcbiAgfVxuICBwcml2YXRlIF9iYzogRWxlbWVudFJlZjtcbiAgcHJpdmF0ZSBfYmxvY2tDb250ZXh0OiBhbnk7XG5cbiAgLyoqXG4gICAqIEVsZW1lbnRSZWYgb2YgdGhlIGNvbG9yIGJhc2VcbiAgICovXG4gIEBWaWV3Q2hpbGQoJ3N0cmlwJywge3N0YXRpYzogZmFsc2V9KSBfc3RyaXA6IEVsZW1lbnRSZWY7XG4gIC8vIGhvbGQgX3N0cmlwIGNvbnRleHRcbiAgcHJpdmF0ZSBfc3RyaXBDb250ZXh0OiBhbnk7XG5cbiAgLyoqXG4gICAqIENvbnRhaW5lciBvZiB0aGUgc3RyaXBcbiAgICovXG4gIEBWaWV3Q2hpbGQoJ3N0cmlwQ29udGFpbmVyJywge3N0YXRpYzogZmFsc2V9KVxuICBzZXQgc3RyaXBDdXJzb3IoZWw6IEVsZW1lbnRSZWYpIHtcbiAgICB0aGlzLl9zYyA9IGVsO1xuICB9XG4gIHByaXZhdGUgX3NjOiBFbGVtZW50UmVmO1xuXG4gIC8qKlxuICAgKiBDaGFuZ2UgaGVpZ2h0IGJhc2Ugb2YgdGhlIHNlbGVjdG9yXG4gICAqL1xuICBASW5wdXQoJ2hlaWdodCcpXG4gIHNldCBoZWlnaHQodmFsdWU6IG51bWJlcikge1xuICAgIHRoaXMuX2hlaWdodCA9IHZhbHVlO1xuICB9XG4gIGdldCBzZWxlY3RvckhlaWdodCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl9oZWlnaHQ7XG4gIH1cbiAgZ2V0IHN0cmlwSGVpZ2h0KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuX2hlaWdodCAtIDEwO1xuICB9XG4gIHByaXZhdGUgX2hlaWdodDogbnVtYmVyID0gMTcwO1xuXG4gIC8qKlxuICAgKiBSZWNlaXZlIHNlbGVjdGVkIGNvbG9yIGZyb20gdGhlIGNvbXBvbmVudFxuICAgKi9cbiAgQElucHV0KClcbiAgZ2V0IHNlbGVjdGVkQ29sb3IoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5fc2VsZWN0ZWRDb2xvcjtcbiAgfVxuICBzZXQgc2VsZWN0ZWRDb2xvcih2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5fc2VsZWN0ZWRDb2xvciA9IHZhbHVlIHx8IHRoaXMuZW1wdHlDb2xvcjtcbiAgfVxuICBwcml2YXRlIF9zZWxlY3RlZENvbG9yOiBzdHJpbmcgPSAnJztcblxuICAvKipcbiAgICogSGlkZSB0aGUgaGV4YWRlY2ltYWwgY29sb3IgZm9ybXMuXG4gICAqL1xuICBASW5wdXQoJ2hpZGVIZXhGb3JtcycpXG4gIGdldCBoaWRlSGV4Rm9ybXMoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2hpZGVIZXhGb3JtcztcbiAgfVxuICBzZXQgaGlkZUhleEZvcm1zKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5faGlkZUhleEZvcm1zID0gdmFsdWU7XG4gIH1cbiAgcHJpdmF0ZSBfaGlkZUhleEZvcm1zOiBib29sZWFuID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEVtaXQgdXBkYXRlIHdoZW4gYSBjb2xvciBpcyBzZWxlY3RlZFxuICAgKi9cbiAgQE91dHB1dCgpIGNoYW5nZVNlbGVjdGVkQ29sb3IgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgLyoqXG4gICAqIFJHQkEgY3VycmVudCBjb2xvclxuICAgKi9cbiAgcHJpdmF0ZSBfcmdiYUNvbG9yOiBzdHJpbmcgPSAncmdiYSgyNTUsMCwwLDEpJztcblxuICAvKipcbiAgICogU3ViamVjdCBvZiB0aGUgY3VycmVudCBzZWxlY3RlZCBjb2xvciBieSB0aGUgdXNlclxuICAgKi9cbiAgcHJpdmF0ZSBfdG1wU2VsZWN0ZWRDb2xvcjogQmVoYXZpb3JTdWJqZWN0PHN0cmluZz47XG5cbiAgLyoqXG4gICAqIFN1YnNjcmlwdGlvbiBvZiB0aGUgdG1wU2VsZWN0ZWRDb2xvciBPYnNlcnZhYmxlXG4gICAqL1xuICBwcml2YXRlIF90bXBTZWxlY3RlZENvbG9yU3ViOiBTdWJzY3JpcHRpb247XG5cbiAgLyoqXG4gICAqIFN1YnNjcmlwdGlvbiBvZiB0aGUgaGV4Rm9ybSB2YWx1ZXMgY2hhbmdlXG4gICAqL1xuICBwcml2YXRlIF9oZXhWYWx1ZXNTdWI6IFN1YnNjcmlwdGlvbjtcblxuICAvKipcbiAgICogU3Vic2NyaXB0aW9uIG9mIHRoZSByYmdGb3JtIHZhbHVlcyBjaGFuZ2VcbiAgICovXG4gIHByaXZhdGUgX3JnYlZhbHVlc1N1YjogU3Vic2NyaXB0aW9uO1xuXG4gIC8qKlxuICAgKiBIYW5kbGUgY29sb3Igb2YgdGhlIHRleHRcbiAgICovXG4gIHRleHRDbGFzczogc3RyaW5nID0gJ2JsYWNrJztcblxuICAvKipcbiAgICogVmFsaWRhdGUgaWYgdGhlIG1vdXNlIGJ1dHRvbiBpcyBwcmVzc2VkXG4gICAqL1xuICBfaXNQcmVzc2VkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEZvcm0gb2YgdGhlIGNvbG9yIGluIGhleGFcbiAgICovXG4gIGhleEZvcm06IEZvcm1Hcm91cDtcblxuICAvKipcbiAgICogRm9ybSBhbmQga2V5cyBvZiB0aGUgZmllbGRzIGluIFJHQlxuICAgKi9cbiAgcmdiS2V5cyA9IFsnUicsICdHJywgJ0InXTtcbiAgcmdiRm9ybTogRm9ybUdyb3VwO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyLFxuICAgIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsXG4gICAgQEluamVjdChFTVBUWV9DT0xPUikgcHJpdmF0ZSBlbXB0eUNvbG9yOiBzdHJpbmdcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuX3RtcFNlbGVjdGVkQ29sb3IgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PHN0cmluZz4odGhpcy5fc2VsZWN0ZWRDb2xvcik7XG4gICAgdGhpcy5fdG1wU2VsZWN0ZWRDb2xvclN1YiA9IHRoaXMuX3RtcFNlbGVjdGVkQ29sb3Iuc3Vic2NyaWJlKGNvbG9yID0+IHtcbiAgICAgIGlmIChjb2xvciAhPT0gdGhpcy5fc2VsZWN0ZWRDb2xvciAmJiBpc1ZhbGlkQ29sb3IoY29sb3IpKSB7XG4gICAgICAgIGlmICh0aGlzLmhleEZvcm0uZ2V0KCdoZXhDb2RlJykudmFsdWUgIT09IGNvbG9yKSB7XG4gICAgICAgICAgdGhpcy5oZXhGb3JtLnNldFZhbHVlKHsgaGV4Q29kZTogY29sb3IgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jaGFuZ2VTZWxlY3RlZENvbG9yLmVtaXQoY29lcmNlSGV4YUNvbG9yKGNvbG9yKSB8fCB0aGlzLmVtcHR5Q29sb3IpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gaGV4IGZvcm1cbiAgICB0aGlzLmhleEZvcm0gPSB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKHtcbiAgICAgIGhleENvZGU6IFt0aGlzLnNlbGVjdGVkQ29sb3IsIFtWYWxpZGF0b3JzLm1pbkxlbmd0aCg3KSwgVmFsaWRhdG9ycy5tYXhMZW5ndGgoNyldXSxcbiAgICB9KTtcblxuICAgIC8vIHJnYiBkeW5hbWljIGZvcm1cbiAgICBjb25zdCByZ2JHcm91cDogYW55ID0ge307XG4gICAgY29uc3QgcmdiVmFsdWU6IG51bWJlcltdID0gdGhpcy5fZ2V0UkdCKCk7XG4gICAgdGhpcy5yZ2JLZXlzLmZvckVhY2goXG4gICAgICAoa2V5LCBpbmRleCkgPT5cbiAgICAgICAgKHJnYkdyb3VwW2tleV0gPSBuZXcgRm9ybUNvbnRyb2wocmdiVmFsdWVbaW5kZXhdLCB7XG4gICAgICAgICAgdmFsaWRhdG9yczogW1xuICAgICAgICAgICAgVmFsaWRhdG9ycy5taW4oMCksXG4gICAgICAgICAgICBWYWxpZGF0b3JzLm1heCgyNTYpLFxuICAgICAgICAgICAgVmFsaWRhdG9ycy5yZXF1aXJlZCxcbiAgICAgICAgICAgIFZhbGlkYXRvcnMubWF4TGVuZ3RoKDMpLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgdXBkYXRlT246ICdibHVyJyxcbiAgICAgICAgfSkpXG4gICAgKTtcbiAgICB0aGlzLnJnYkZvcm0gPSB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKHJnYkdyb3VwKTtcblxuICAgIC8vIHdhdGNoIGNoYW5nZXMgb24gZm9ybXNcbiAgICB0aGlzLl9vbkNoYW5nZXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgUkdCLCBSR0JBIGFuZCBHcmFkaWVudCB3aGVuIHNlbGVjdGVkQ29sb3IgY2hhbmdlIGFuZFxuICAgKiB0aGUgbW91c2UgYnV0dG9uIGlzIHByZXNzZWRcbiAgICogQHBhcmFtIGNoYW5nZXMgU2ltcGxlQ2hhbmdlc1xuICAgKi9cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGlmICgnc2VsZWN0ZWRDb2xvcicgaW4gY2hhbmdlcyAmJiBjaGFuZ2VzWydzZWxlY3RlZENvbG9yJ10uY3VycmVudFZhbHVlICE9PSB0aGlzLmVtcHR5Q29sb3IpIHtcbiAgICAgIGlmICghdGhpcy5faXNQcmVzc2VkKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZVJHQigpO1xuICAgICAgICB0aGlzLl91cGRhdGVSR0JBKCk7XG4gICAgICAgIGlmICh0aGlzLl9ibG9ja0NvbnRleHQpIHtcbiAgICAgICAgICB0aGlzLl9maWxsR3JhZGllbnQoKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCByZ2IgPSB0aGlzLl9nZXRSR0IoKTtcbiAgICAgIGNvbnN0IG8gPSBNYXRoLnJvdW5kKChyZ2JbMF0gKiAyOTkgKyByZ2JbMV0gKiA1ODcgKyByZ2JbMl0gKiAxMTQpIC8gMTAwMCk7XG4gICAgICB0aGlzLnRleHRDbGFzcyA9IG8gPiAxMjUgPyAnYmxhY2snIDogJ3doaXRlJztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGVzdHJveSBhbGwgc3Vic2NyaXB0aW9uc1xuICAgKi9cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuX3RtcFNlbGVjdGVkQ29sb3JTdWIgJiYgIXRoaXMuX3RtcFNlbGVjdGVkQ29sb3JTdWIuY2xvc2VkKSB7XG4gICAgICB0aGlzLl90bXBTZWxlY3RlZENvbG9yU3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLl9oZXhWYWx1ZXNTdWIgJiYgIXRoaXMuX2hleFZhbHVlc1N1Yi5jbG9zZWQpIHtcbiAgICAgIHRoaXMuX2hleFZhbHVlc1N1Yi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5fcmdiVmFsdWVzU3ViICYmICF0aGlzLl9yZ2JWYWx1ZXNTdWIuY2xvc2VkKSB7XG4gICAgICB0aGlzLl9yZ2JWYWx1ZXNTdWIudW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5yZW5kZXIubGlzdGVuKHRoaXMuX2Jsb2NrLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWRvd24nLCBlID0+IHtcbiAgICAgIHRoaXMuX2lzUHJlc3NlZCA9IHRydWU7XG4gICAgICB0aGlzLmNoYW5nZUNvbG9yKGUpO1xuICAgIH0pO1xuICAgIHRoaXMucmVuZGVyLmxpc3Rlbih0aGlzLl9ibG9jay5uYXRpdmVFbGVtZW50LCAnbW91c2V1cCcsICgpID0+ICh0aGlzLl9pc1ByZXNzZWQgPSBmYWxzZSkpO1xuICAgIHRoaXMucmVuZGVyLmxpc3Rlbih0aGlzLl9ibG9jay5uYXRpdmVFbGVtZW50LCAnbW91c2VvdXQnLCAoKSA9PiAodGhpcy5faXNQcmVzc2VkID0gZmFsc2UpKTtcbiAgICB0aGlzLnJlbmRlci5saXN0ZW4odGhpcy5fYmxvY2submF0aXZlRWxlbWVudCwgJ21vdXNlbW92ZScsIGUgPT4gdGhpcy5jaGFuZ2VDb2xvcihlKSk7XG4gICAgdGhpcy5fYmxvY2tDb250ZXh0ID0gdGhpcy5fYmMubmF0aXZlRWxlbWVudC5nZXRDb250ZXh0KCcyZCcpO1xuICAgIHRoaXMuX2Jsb2NrQ29udGV4dC5yZWN0KDAsIDAsIHRoaXMuX2JjLm5hdGl2ZUVsZW1lbnQud2lkdGgsIHRoaXMuX2JjLm5hdGl2ZUVsZW1lbnQuaGVpZ2h0KTtcblxuICAgIHRoaXMucmVuZGVyLmxpc3Rlbih0aGlzLl9zdHJpcC5uYXRpdmVFbGVtZW50LCAnbW91c2Vkb3duJywgZSA9PiB7XG4gICAgICB0aGlzLl9pc1ByZXNzZWQgPSB0cnVlO1xuICAgICAgdGhpcy5jaGFuZ2VCYXNlQ29sb3IoZSk7XG4gICAgfSk7XG4gICAgdGhpcy5yZW5kZXIubGlzdGVuKHRoaXMuX3N0cmlwLm5hdGl2ZUVsZW1lbnQsICdtb3VzZXVwJywgKCkgPT4gKHRoaXMuX2lzUHJlc3NlZCA9IGZhbHNlKSk7XG4gICAgdGhpcy5yZW5kZXIubGlzdGVuKHRoaXMuX3N0cmlwLm5hdGl2ZUVsZW1lbnQsICdtb3VzZW91dCcsICgpID0+ICh0aGlzLl9pc1ByZXNzZWQgPSBmYWxzZSkpO1xuICAgIHRoaXMucmVuZGVyLmxpc3Rlbih0aGlzLl9zdHJpcC5uYXRpdmVFbGVtZW50LCAnbW91c2Vtb3ZlJywgZSA9PiB0aGlzLmNoYW5nZUJhc2VDb2xvcihlKSk7XG4gICAgdGhpcy5fc3RyaXBDb250ZXh0ID0gdGhpcy5fc3RyaXAubmF0aXZlRWxlbWVudC5nZXRDb250ZXh0KCcyZCcpO1xuICAgIHRoaXMuX3N0cmlwQ29udGV4dC5yZWN0KFxuICAgICAgMCxcbiAgICAgIDAsXG4gICAgICB0aGlzLl9zdHJpcC5uYXRpdmVFbGVtZW50LndpZHRoLFxuICAgICAgdGhpcy5fc3RyaXAubmF0aXZlRWxlbWVudC5oZWlnaHRcbiAgICApO1xuICAgIGNvbnN0IGdyZDEgPSB0aGlzLl9zdHJpcENvbnRleHQuY3JlYXRlTGluZWFyR3JhZGllbnQoMCwgMCwgMCwgdGhpcy5fYmMubmF0aXZlRWxlbWVudC5oZWlnaHQpO1xuICAgIGdyZDEuYWRkQ29sb3JTdG9wKDAsICdyZ2JhKDI1NSwgMCwgMCwgMSknKTtcbiAgICBncmQxLmFkZENvbG9yU3RvcCgwLjE3LCAncmdiYSgyNTUsIDI1NSwgMCwgMSknKTtcbiAgICBncmQxLmFkZENvbG9yU3RvcCgwLjM0LCAncmdiYSgwLCAyNTUsIDAsIDEpJyk7XG4gICAgZ3JkMS5hZGRDb2xvclN0b3AoMC41MSwgJ3JnYmEoMCwgMjU1LCAyNTUsIDEpJyk7XG4gICAgZ3JkMS5hZGRDb2xvclN0b3AoMC42OCwgJ3JnYmEoMCwgMCwgMjU1LCAxKScpO1xuICAgIGdyZDEuYWRkQ29sb3JTdG9wKDAuODUsICdyZ2JhKDI1NSwgMCwgMjU1LCAxKScpO1xuICAgIGdyZDEuYWRkQ29sb3JTdG9wKDEsICdyZ2JhKDI1NSwgMCwgMCwgMSknKTtcbiAgICB0aGlzLl9zdHJpcENvbnRleHQuZmlsbFN0eWxlID0gZ3JkMTtcbiAgICB0aGlzLl9zdHJpcENvbnRleHQuZmlsbCgpO1xuXG4gICAgdGhpcy5fZmlsbEdyYWRpZW50KCk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgY29sb3JzIGJhc2VkIG9uIHRoZSBSR0JBIGNvbG9yXG4gICAqL1xuICBwcml2YXRlIF9maWxsR3JhZGllbnQoKTogdm9pZCB7XG4gICAgdGhpcy5fYmxvY2tDb250ZXh0LmZpbGxTdHlsZSA9IHRoaXMuX3JnYmFDb2xvcjtcbiAgICB0aGlzLl9ibG9ja0NvbnRleHQuZmlsbFJlY3QoMCwgMCwgdGhpcy5fYmMubmF0aXZlRWxlbWVudC53aWR0aCwgdGhpcy5fYmMubmF0aXZlRWxlbWVudC5oZWlnaHQpO1xuXG4gICAgY29uc3QgZ3JkV2hpdGUgPSB0aGlzLl9zdHJpcENvbnRleHQuY3JlYXRlTGluZWFyR3JhZGllbnQoMCwgMCwgdGhpcy5fYmMubmF0aXZlRWxlbWVudC53aWR0aCwgMCk7XG4gICAgZ3JkV2hpdGUuYWRkQ29sb3JTdG9wKDAsICdyZ2JhKDI1NSwyNTUsMjU1LDEpJyk7XG4gICAgZ3JkV2hpdGUuYWRkQ29sb3JTdG9wKDEsICdyZ2JhKDI1NSwyNTUsMjU1LDApJyk7XG4gICAgdGhpcy5fYmxvY2tDb250ZXh0LmZpbGxTdHlsZSA9IGdyZFdoaXRlO1xuICAgIHRoaXMuX2Jsb2NrQ29udGV4dC5maWxsUmVjdCgwLCAwLCB0aGlzLl9iYy5uYXRpdmVFbGVtZW50LndpZHRoLCB0aGlzLl9iYy5uYXRpdmVFbGVtZW50LmhlaWdodCk7XG5cbiAgICBjb25zdCBncmRCbGFjayA9IHRoaXMuX3N0cmlwQ29udGV4dC5jcmVhdGVMaW5lYXJHcmFkaWVudChcbiAgICAgIDAsXG4gICAgICAwLFxuICAgICAgMCxcbiAgICAgIHRoaXMuX2JjLm5hdGl2ZUVsZW1lbnQuaGVpZ2h0XG4gICAgKTtcbiAgICBncmRCbGFjay5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMCwwLDAsMCknKTtcbiAgICBncmRCbGFjay5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoMCwwLDAsMSknKTtcbiAgICB0aGlzLl9ibG9ja0NvbnRleHQuZmlsbFN0eWxlID0gZ3JkQmxhY2s7XG4gICAgdGhpcy5fYmxvY2tDb250ZXh0LmZpbGxSZWN0KDAsIDAsIHRoaXMuX2JjLm5hdGl2ZUVsZW1lbnQud2lkdGgsIHRoaXMuX2JjLm5hdGl2ZUVsZW1lbnQuaGVpZ2h0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXYXRjaCBjaGFuZ2Ugb24gZm9ybXNcbiAgICovXG4gIHByaXZhdGUgX29uQ2hhbmdlcygpIHtcbiAgICAvLyB2YWxpZGF0ZSBkaWdpdGVkIGNvZGUgYW5kIHVwZGF0ZSB3aGVuIGRpZ2l0YXRpb24gaXMgZmluaXNoZWRcbiAgICB0aGlzLl9oZXhWYWx1ZXNTdWIgPSB0aGlzLmhleEZvcm0uZ2V0KCdoZXhDb2RlJykudmFsdWVDaGFuZ2VzXG4gICAgICAucGlwZShtYXAoY29sb3IgPT4gY29sb3IgIT09IHRoaXMuZW1wdHlDb2xvciA/IGNvZXJjZUhleGFDb2xvcihjb2xvcikgOiBjb2xvcikpXG4gICAgICAuc3Vic2NyaWJlKHZhbHVlID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLl9pc1ByZXNzZWQgJiYgaXNWYWxpZENvbG9yKHZhbHVlKSkge1xuICAgICAgICAgIHRoaXMuX3RtcFNlbGVjdGVkQ29sb3IubmV4dCh2YWx1ZSB8fCB0aGlzLmVtcHR5Q29sb3IpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIHRoaXMuX3JnYlZhbHVlc1N1YiA9IHRoaXMucmdiRm9ybS52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKGNvbnRyb2xzID0+IHtcbiAgICAgIGNvbnN0IGRhdGE6IHN0cmluZ1tdID0gW107XG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiBjb250cm9scykge1xuICAgICAgICBpZiAoIWNvbnRyb2xzW2tleV0gJiYgY29udHJvbHNba2V5XSAhPT0gMCB8fCBjb250cm9sc1trZXldID4gMjU1KSB7XG4gICAgICAgICAgZGF0YS5wdXNoKCcnKTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGRhdGEucHVzaChjb250cm9sc1trZXldKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgaGV4ID0gdGhpcy5fZ2V0SGV4KGRhdGEpO1xuICAgICAgaWYgKGhleCAhPT0gdGhpcy5fc2VsZWN0ZWRDb2xvciAmJiBoZXgubGVuZ3RoID09PSA3KSB7XG4gICAgICAgIHRoaXMuX3RtcFNlbGVjdGVkQ29sb3IubmV4dChoZXgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnQgSEVYL2NhbnZhcyB2YWx1ZSB0byByZ2JcbiAgICogQHBhcmFtIGRhdGEgYW55XG4gICAqIEByZXR1cm5zIG51bWJlcltdXG4gICAqL1xuICBwcml2YXRlIF9nZXRSR0IoZGF0YT86IGFueSk6IG51bWJlcltdIHtcbiAgICBpZiAoZGF0YSkge1xuICAgICAgcmV0dXJuIFtkYXRhWzBdLCBkYXRhWzFdLCBkYXRhWzJdXTtcbiAgICB9XG4gICAgY29uc3QgaGV4ID0gdGhpcy5fc2VsZWN0ZWRDb2xvci5yZXBsYWNlKCcjJywgJycpO1xuICAgIGNvbnN0IHIgPSBwYXJzZUludChoZXguc2xpY2UoMCwgMiksIDE2KTtcbiAgICBjb25zdCBnID0gcGFyc2VJbnQoaGV4LnNsaWNlKDIsIDQpLCAxNik7XG4gICAgY29uc3QgYiA9IHBhcnNlSW50KGhleC5zbGljZSg0LCA2KSwgMTYpO1xuXG4gICAgcmV0dXJuIFtyLCBnLCBiXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZXJ0IFJHQiB2YWx1ZSB0byBIRVhcbiAgICogQHBhcmFtIGRhdGEgYW55XG4gICAqIEByZXR1cm5zIHN0cmluZ1xuICAgKi9cbiAgcHJpdmF0ZSBfZ2V0SGV4KGRhdGE6IGFueSk6IHN0cmluZyB7XG4gICAgY29uc3QgaGV4ID0gbmV3IEFycmF5KDMpO1xuICAgIGhleFswXSA9IGRhdGFbMF0udG9TdHJpbmcoMTYpO1xuICAgIGhleFsxXSA9IGRhdGFbMV0udG9TdHJpbmcoMTYpO1xuICAgIGhleFsyXSA9IGRhdGFbMl0udG9TdHJpbmcoMTYpO1xuXG4gICAgaGV4LmZvckVhY2goKHZhbCwga2V5KSA9PiB7XG4gICAgICBpZiAodmFsLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBoZXhba2V5XSA9ICcwJyArIGhleFtrZXldO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGNvZXJjZUhleGFDb2xvcihgJHtoZXhbMF19JHtoZXhbMV19JHtoZXhbMl19YCkgfHwgdGhpcy5lbXB0eUNvbG9yO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBSR0JBIGNvbG9yXG4gICAqIEBwYXJhbSBkYXRhIGFueVxuICAgKi9cbiAgcHJpdmF0ZSBfdXBkYXRlUkdCQShkYXRhPzogYW55KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLl9zZWxlY3RlZENvbG9yICYmICFkYXRhKSB7XG4gICAgICB0aGlzLl9yZ2JhQ29sb3IgPSAncmdiYSgyNTUsMCwwLDEpJztcbiAgICB9XG5cbiAgICBjb25zdCByZ2IgPSB0aGlzLl9nZXRSR0IoZGF0YSk7XG4gICAgdGhpcy5fcmdiYUNvbG9yID0gYHJnYmEoJHtyZ2JbMF19LCAke3JnYlsxXX0sICR7cmdiWzJdfSwgMSlgO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBSR0IgZm9ybVxuICAgKiBAcGFyYW0gZGF0YSBhbnlcbiAgICovXG4gIHByaXZhdGUgX3VwZGF0ZVJHQihkYXRhPzogYW55KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnJnYkZvcm0pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIWRhdGEpIHtcbiAgICAgIGRhdGEgPSB0aGlzLl9nZXRSR0IoKTtcbiAgICB9XG5cbiAgICB0aGlzLnJnYkZvcm0uc2V0VmFsdWUoeyBSOiBkYXRhWzBdLCBHOiBkYXRhWzFdLCBCOiBkYXRhWzJdIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzZWxlY3RlZCBiYXNlIGNvbG9yIGZyb20gdGhlIGNhbnZhc1xuICAgKiBAcGFyYW0gZSBNb3VzZUV2ZW50XG4gICAqL1xuICBwcml2YXRlIGNoYW5nZUJhc2VDb2xvcihlKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX2lzUHJlc3NlZCkge1xuICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5fc2MubmF0aXZlRWxlbWVudCwgJ2JhY2tncm91bmQtcG9zaXRpb24teScsIGAke2Uub2Zmc2V0WX1weGApO1xuICAgICAgY29uc3QgZGF0YSA9IHRoaXMuX3N0cmlwQ29udGV4dC5nZXRJbWFnZURhdGEoZS5vZmZzZXRYLCBlLm9mZnNldFksIDEsIDEpLmRhdGE7XG4gICAgICB0aGlzLl91cGRhdGVSR0JBKGRhdGEpO1xuICAgICAgdGhpcy5fZmlsbEdyYWRpZW50KCk7XG4gICAgICB0aGlzLnVwZGF0ZVZhbHVlcyhkYXRhKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHNlbGVjdGVkIGNvbG9yIGZyb20gdGhlIGNhbnZhc1xuICAgKiBAcGFyYW0gZSBNb3VzZUV2ZW50XG4gICAqL1xuICBwcml2YXRlIGNoYW5nZUNvbG9yKGUpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5faXNQcmVzc2VkKSB7XG4gICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLl9icC5uYXRpdmVFbGVtZW50LCAndG9wJywgYCR7ZS5vZmZzZXRZIC0gNX1weGApO1xuICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5fYnAubmF0aXZlRWxlbWVudCwgJ2xlZnQnLCBgJHtlLm9mZnNldFggLSA1fXB4YCk7XG5cbiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLl9ibG9ja0NvbnRleHQuZ2V0SW1hZ2VEYXRhKGUub2Zmc2V0WCwgZS5vZmZzZXRZLCAxLCAxKS5kYXRhO1xuICAgICAgdGhpcy51cGRhdGVWYWx1ZXMoZGF0YSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVtaXQgdXBkYXRlIGZyb20gdGhlIHNlbGVjdGVkIGNvbG9yXG4gICAqIEBwYXJhbSBkYXRhIGFueVxuICAgKi9cbiAgcHJpdmF0ZSB1cGRhdGVWYWx1ZXMoZGF0YTogYW55KTogdm9pZCB7XG4gICAgaWYgKGRhdGEpIHtcbiAgICAgIHRoaXMuX3VwZGF0ZVJHQihkYXRhKTtcbiAgICAgIHRoaXMuX3RtcFNlbGVjdGVkQ29sb3IubmV4dCh0aGlzLl9nZXRIZXgoZGF0YSkpO1xuICAgIH1cbiAgfVxufVxuIl19