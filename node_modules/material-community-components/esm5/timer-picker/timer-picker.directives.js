import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Directive, ElementRef, forwardRef, Input, Output, Renderer2, } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { MccTimerPickerComponent } from './timer-picker.component';
import { BehaviorSubject } from 'rxjs';
var MccTimerPickerOriginDirective = /** @class */ (function () {
    /**
     * Reference to the element on which the directive is applied.
     */
    function MccTimerPickerOriginDirective(elementRef, renderer) {
        var _this = this;
        this.elementRef = elementRef;
        this.renderer = renderer;
        /**
         * Emit changes from the origin
         */
        this.change = new BehaviorSubject('');
        /**
         * Emit changes from the origin
         */
        this.hasFocus = new BehaviorSubject(false);
        // listen focus
        renderer.listen(elementRef.nativeElement, 'focus', function () { return _this.hasFocus.next(true); });
    }
    MccTimerPickerOriginDirective_1 = MccTimerPickerOriginDirective;
    /**
     * This method will be called by the forms API to write to the view when
     * programmatic (model -> view) changes are requested.
     */
    MccTimerPickerOriginDirective.prototype.writeValue = function (time) {
        this.renderer.setProperty(this.elementRef.nativeElement, 'value', time);
        this.change.next(time);
        if (this.propagateChanges) {
            this.propagateChanges(time);
        }
    };
    /**
     * This method will be called by the time picker
     */
    MccTimerPickerOriginDirective.prototype.writeValueFromTimerPicker = function (time) {
        this.renderer.setProperty(this.elementRef.nativeElement, 'value', time);
        this.propagateChanges(time);
    };
    /**
     * This method will be called from origin whe key is up
     */
    MccTimerPickerOriginDirective.prototype.writeValueFromKeyup = function (time) {
        this.change.next(time);
        this.propagateChanges(time);
    };
    /**
     * This is called by the forms API on initialization so it can update the
     * form model when values propagate from the view (view -> model).
     * @param fn any
     */
    MccTimerPickerOriginDirective.prototype.registerOnChange = function (fn) {
        this.propagateChanges = fn;
    };
    /**
     * This is called by the forms API on initialization so it can update the form model on blur
     * @param fn any
     */
    MccTimerPickerOriginDirective.prototype.registerOnTouched = function (fn) { };
    /**
     * called by the forms API when the control status changes to or from "DISABLED"
     * @param isDisabled boolean
     */
    MccTimerPickerOriginDirective.prototype.setDisabledState = function (isDisabled) {
        this.renderer.setProperty(this.elementRef.nativeElement, 'disabled', isDisabled);
    };
    var MccTimerPickerOriginDirective_1;
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", BehaviorSubject)
    ], MccTimerPickerOriginDirective.prototype, "change", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", BehaviorSubject)
    ], MccTimerPickerOriginDirective.prototype, "hasFocus", void 0);
    MccTimerPickerOriginDirective = MccTimerPickerOriginDirective_1 = tslib_1.__decorate([
        Directive({
            selector: '[mccTimerPickerOrigin], [mcc-timer-picker-origin]',
            exportAs: 'mccTimerPickerOrigin',
            providers: [
                {
                    provide: NG_VALUE_ACCESSOR,
                    useExisting: forwardRef(function () { return MccTimerPickerOriginDirective_1; }),
                    multi: true,
                },
            ],
        }),
        tslib_1.__metadata("design:paramtypes", [ElementRef, Renderer2])
    ], MccTimerPickerOriginDirective);
    return MccTimerPickerOriginDirective;
}());
export { MccTimerPickerOriginDirective };
var MccConnectedTimerPickerDirective = /** @class */ (function () {
    function MccConnectedTimerPickerDirective(timerPicker, changeDetectorRef) {
        this.timerPicker = timerPicker;
        this.changeDetectorRef = changeDetectorRef;
        this.timerPicker.connected = true;
    }
    MccConnectedTimerPickerDirective.prototype.ngAfterViewInit = function () {
        if (!this._timerPickerSub) {
            this.timerPicker.trigger = this.origin;
            this._attachTimerPicker();
        }
    };
    MccConnectedTimerPickerDirective.prototype.ngOnDestroy = function () {
        if (this._originFocus && !this._originFocus.closed) {
            this._originFocus.unsubscribe();
        }
        if (this._timerPickerSub && !this._timerPickerSub.closed) {
            this._timerPickerSub.unsubscribe();
        }
    };
    /**
     * Attach the timer picker to origin element (input)
     */
    MccConnectedTimerPickerDirective.prototype._attachTimerPicker = function () {
        var _this = this;
        this._originFocus = this.origin.hasFocus.subscribe(function (focused) {
            _this.timerPicker.focus = 'hour';
            _this.timerPicker.isOpen = focused;
            _this.changeDetectorRef.detectChanges();
        });
        this._timerPickerSub = this.timerPicker.selected.subscribe(function (value) {
            return _this.origin.writeValueFromTimerPicker(value);
        });
    };
    tslib_1.__decorate([
        Input('mccConnectedTimerPickerOrigin'),
        tslib_1.__metadata("design:type", MccTimerPickerOriginDirective)
    ], MccConnectedTimerPickerDirective.prototype, "origin", void 0);
    MccConnectedTimerPickerDirective = tslib_1.__decorate([
        Directive({
            selector: '[mccConnectedTimerPicker], [mcc-connected-timer-picker]',
            exportAs: 'mccConnectedTimerPicker',
        }),
        tslib_1.__metadata("design:paramtypes", [MccTimerPickerComponent,
            ChangeDetectorRef])
    ], MccConnectedTimerPickerDirective);
    return MccConnectedTimerPickerDirective;
}());
export { MccConnectedTimerPickerDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZXItcGlja2VyLmRpcmVjdGl2ZXMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9tYXRlcmlhbC1jb21tdW5pdHktY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbInRpbWVyLXBpY2tlci90aW1lci1waWNrZXIuZGlyZWN0aXZlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUVMLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsVUFBVSxFQUNWLFVBQVUsRUFDVixLQUFLLEVBQ0wsTUFBTSxFQUVOLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNuRCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNuRSxPQUFPLEVBQWdCLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQWFyRDtJQWdCRTs7T0FFRztJQUNILHVDQUFtQixVQUFzQixFQUFVLFFBQW1CO1FBQXRFLGlCQUdDO1FBSGtCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBbEJ0RTs7V0FFRztRQUNPLFdBQU0sR0FBNEIsSUFBSSxlQUFlLENBQVMsRUFBRSxDQUFDLENBQUM7UUFFNUU7O1dBRUc7UUFDTyxhQUFRLEdBQTZCLElBQUksZUFBZSxDQUFVLEtBQUssQ0FBQyxDQUFDO1FBV2pGLGVBQWU7UUFDZixRQUFRLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsT0FBTyxFQUFFLGNBQU0sT0FBQSxLQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBeEIsQ0FBd0IsQ0FBQyxDQUFDO0lBQ3JGLENBQUM7c0NBdEJVLDZCQUE2QjtJQXdCeEM7OztPQUdHO0lBQ0gsa0RBQVUsR0FBVixVQUFXLElBQVk7UUFDckIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxh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QVksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsVUFBQSxPQUFPO1lBQ3hELEtBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQztZQUNoQyxLQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUM7WUFDbEMsS0FBSSxDQUFDLGlCQUFpQixDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3pDLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsVUFBQSxLQUFLO1lBQzlELE9BQUEsS0FBSSxDQUFDLE1BQU0sQ0FBQyx5QkFBeUIsQ0FBQyxLQUFLLENBQUM7UUFBNUMsQ0FBNEMsQ0FDN0MsQ0FBQztJQUNKLENBQUM7SUFoRHVDO1FBQXZDLEtBQUssQ0FBQywrQkFBK0IsQ0FBQzswQ0FBUyw2QkFBNkI7b0VBQUM7SUFKbkUsZ0NBQWdDO1FBSjVDLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSx5REFBeUQ7WUFDbkUsUUFBUSxFQUFFLHlCQUF5QjtTQUNwQyxDQUFDO2lEQWtCdUIsdUJBQXVCO1lBQ2xCLGlCQUFpQjtPQWxCbEMsZ0NBQWdDLENBcUQ1QztJQUFELHVDQUFDO0NBQUEsQUFyREQsSUFxREM7U0FyRFksZ0NBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIERpcmVjdGl2ZSxcbiAgRWxlbWVudFJlZixcbiAgZm9yd2FyZFJlZixcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgT25EZXN0cm95LFxuICBSZW5kZXJlcjIsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBNY2NUaW1lclBpY2tlckNvbXBvbmVudCB9IGZyb20gJy4vdGltZXItcGlja2VyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24sIEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbbWNjVGltZXJQaWNrZXJPcmlnaW5dLCBbbWNjLXRpbWVyLXBpY2tlci1vcmlnaW5dJyxcbiAgZXhwb3J0QXM6ICdtY2NUaW1lclBpY2tlck9yaWdpbicsXG4gIHByb3ZpZGVyczogW1xuICAgIHtcbiAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gTWNjVGltZXJQaWNrZXJPcmlnaW5EaXJlY3RpdmUpLFxuICAgICAgbXVsdGk6IHRydWUsXG4gICAgfSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgTWNjVGltZXJQaWNrZXJPcmlnaW5EaXJlY3RpdmUge1xuICAvKipcbiAgICogRW1pdCBjaGFuZ2VzIGZyb20gdGhlIG9yaWdpblxuICAgKi9cbiAgQE91dHB1dCgpIGNoYW5nZTogQmVoYXZpb3JTdWJqZWN0PHN0cmluZz4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PHN0cmluZz4oJycpO1xuXG4gIC8qKlxuICAgKiBFbWl0IGNoYW5nZXMgZnJvbSB0aGUgb3JpZ2luXG4gICAqL1xuICBAT3V0cHV0KCkgaGFzRm9jdXM6IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4oZmFsc2UpO1xuXG4gIC8qKlxuICAgKiBQcm9wYWdhdGUgY2hhbmdlcyB0byBhbmd1bGFyXG4gICAqL1xuICBwcm9wYWdhdGVDaGFuZ2VzOiAoXzogYW55KSA9PiB7fTtcblxuICAvKipcbiAgICogUmVmZXJlbmNlIHRvIHRoZSBlbGVtZW50IG9uIHdoaWNoIHRoZSBkaXJlY3RpdmUgaXMgYXBwbGllZC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBlbGVtZW50UmVmOiBFbGVtZW50UmVmLCBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHtcbiAgICAvLyBsaXN0ZW4gZm9jdXNcbiAgICByZW5kZXJlci5saXN0ZW4oZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAnZm9jdXMnLCAoKSA9PiB0aGlzLmhhc0ZvY3VzLm5leHQodHJ1ZSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgY2FsbGVkIGJ5IHRoZSBmb3JtcyBBUEkgdG8gd3JpdGUgdG8gdGhlIHZpZXcgd2hlblxuICAgKiBwcm9ncmFtbWF0aWMgKG1vZGVsIC0+IHZpZXcpIGNoYW5nZXMgYXJlIHJlcXVlc3RlZC5cbiAgICovXG4gIHdyaXRlVmFsdWUodGltZTogc3RyaW5nKSB7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRQcm9wZXJ0eSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ3ZhbHVlJywgdGltZSk7XG4gICAgdGhpcy5jaGFuZ2UubmV4dCh0aW1lKTtcbiAgICBpZiAodGhpcy5wcm9wYWdhdGVDaGFuZ2VzKSB7XG4gICAgICB0aGlzLnByb3BhZ2F0ZUNoYW5nZXModGltZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgbWV0aG9kIHdpbGwgYmUgY2FsbGVkIGJ5IHRoZSB0aW1lIHBpY2tlclxuICAgKi9cbiAgd3JpdGVWYWx1ZUZyb21UaW1lclBpY2tlcih0aW1lOiBzdHJpbmcpIHtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFByb3BlcnR5KHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAndmFsdWUnLCB0aW1lKTtcbiAgICB0aGlzLnByb3BhZ2F0ZUNoYW5nZXModGltZSk7XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBtZXRob2Qgd2lsbCBiZSBjYWxsZWQgZnJvbSBvcmlnaW4gd2hlIGtleSBpcyB1cFxuICAgKi9cbiAgd3JpdGVWYWx1ZUZyb21LZXl1cCh0aW1lOiBzdHJpbmcpIHtcbiAgICB0aGlzLmNoYW5nZS5uZXh0KHRpbWUpO1xuICAgIHRoaXMucHJvcGFnYXRlQ2hhbmdlcyh0aW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIGlzIGNhbGxlZCBieSB0aGUgZm9ybXMgQVBJIG9uIGluaXRpYWxpemF0aW9uIHNvIGl0IGNhbiB1cGRhdGUgdGhlXG4gICAqIGZvcm0gbW9kZWwgd2hlbiB2YWx1ZXMgcHJvcGFnYXRlIGZyb20gdGhlIHZpZXcgKHZpZXcgLT4gbW9kZWwpLlxuICAgKiBAcGFyYW0gZm4gYW55XG4gICAqL1xuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLnByb3BhZ2F0ZUNoYW5nZXMgPSBmbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIGlzIGNhbGxlZCBieSB0aGUgZm9ybXMgQVBJIG9uIGluaXRpYWxpemF0aW9uIHNvIGl0IGNhbiB1cGRhdGUgdGhlIGZvcm0gbW9kZWwgb24gYmx1clxuICAgKiBAcGFyYW0gZm4gYW55XG4gICAqL1xuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7IH1cblxuICAvKipcbiAgICogY2FsbGVkIGJ5IHRoZSBmb3JtcyBBUEkgd2hlbiB0aGUgY29udHJvbCBzdGF0dXMgY2hhbmdlcyB0byBvciBmcm9tIFwiRElTQUJMRURcIlxuICAgKiBAcGFyYW0gaXNEaXNhYmxlZCBib29sZWFuXG4gICAqL1xuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFByb3BlcnR5KHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAnZGlzYWJsZWQnLCBpc0Rpc2FibGVkKTtcbiAgfVxufVxuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbbWNjQ29ubmVjdGVkVGltZXJQaWNrZXJdLCBbbWNjLWNvbm5lY3RlZC10aW1lci1waWNrZXJdJyxcbiAgZXhwb3J0QXM6ICdtY2NDb25uZWN0ZWRUaW1lclBpY2tlcicsXG59KVxuZXhwb3J0IGNsYXNzIE1jY0Nvbm5lY3RlZFRpbWVyUGlja2VyRGlyZWN0aXZlIGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcbiAgLyoqXG4gICAqIG9yaWdpbiBvZiB0aGUgY29ubmVjdGVkIHRpbWVyIHBpY2tlclxuICAgKi9cbiAgQElucHV0KCdtY2NDb25uZWN0ZWRUaW1lclBpY2tlck9yaWdpbicpIG9yaWdpbjogTWNjVGltZXJQaWNrZXJPcmlnaW5EaXJlY3RpdmU7XG5cbiAgLyoqXG4gICAqIHN1YnNjcmlwdGlvbiBvZiB0aGUgb3JpZ2luIGZvY3VzIG9ic2VydmFibGVcbiAgICovXG4gIHByaXZhdGUgX29yaWdpbkZvY3VzOiBTdWJzY3JpcHRpb247XG5cbiAgLyoqXG4gICAqIHN1YnNjcmlwdGlvbiBvZiB0aGUgdGltZXIgcGlja2VyIHNlbGVjdGVkIGNoYW5nZVxuICAgKi9cbiAgcHJpdmF0ZSBfdGltZXJQaWNrZXJTdWI6IFN1YnNjcmlwdGlvbjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHRpbWVyUGlja2VyOiBNY2NUaW1lclBpY2tlckNvbXBvbmVudCxcbiAgICBwdWJsaWMgY2hhbmdlRGV0ZWN0b3JSZWY6IENoYW5nZURldGVjdG9yUmVmXG4gICkge1xuICAgIHRoaXMudGltZXJQaWNrZXIuY29ubmVjdGVkID0gdHJ1ZTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICBpZiAoIXRoaXMuX3RpbWVyUGlja2VyU3ViKSB7XG4gICAgICB0aGlzLnRpbWVyUGlja2VyLnRyaWdnZXIgPSB0aGlzLm9yaWdpbjtcbiAgICAgIHRoaXMuX2F0dGFjaFRpbWVyUGlja2VyKCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuX29yaWdpbkZvY3VzICYmICF0aGlzLl9vcmlnaW5Gb2N1cy5jbG9zZWQpIHtcbiAgICAgIHRoaXMuX29yaWdpbkZvY3VzLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLl90aW1lclBpY2tlclN1YiAmJiAhdGhpcy5fdGltZXJQaWNrZXJTdWIuY2xvc2VkKSB7XG4gICAgICB0aGlzLl90aW1lclBpY2tlclN1Yi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBdHRhY2ggdGhlIHRpbWVyIHBpY2tlciB0byBvcmlnaW4gZWxlbWVudCAoaW5wdXQpXG4gICAqL1xuICBwcml2YXRlIF9hdHRhY2hUaW1lclBpY2tlcigpOiB2b2lkIHtcbiAgICB0aGlzLl9vcmlnaW5Gb2N1cyA9IHRoaXMub3JpZ2luLmhhc0ZvY3VzLnN1YnNjcmliZShmb2N1c2VkID0+IHtcbiAgICAgIHRoaXMudGltZXJQaWNrZXIuZm9jdXMgPSAnaG91cic7XG4gICAgICB0aGlzLnRpbWVyUGlja2VyLmlzT3BlbiA9IGZvY3VzZWQ7XG4gICAgICB0aGlzLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICB9KTtcblxuICAgIHRoaXMuX3RpbWVyUGlja2VyU3ViID0gdGhpcy50aW1lclBpY2tlci5zZWxlY3RlZC5zdWJzY3JpYmUodmFsdWUgPT5cbiAgICAgIHRoaXMub3JpZ2luLndyaXRlVmFsdWVGcm9tVGltZXJQaWNrZXIodmFsdWUpXG4gICAgKTtcbiAgfVxufVxuIl19