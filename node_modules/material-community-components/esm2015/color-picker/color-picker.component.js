import * as tslib_1 from "tslib";
import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChildren, ElementRef, EventEmitter, Inject, Input, Output, QueryList, } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { map } from 'rxjs/operators';
import { EMPTY_COLOR, coerceHexaColor } from './color-picker';
import { MccColorPickerCollectionComponent } from './color-picker-collection.component';
import { MccColorPickerService } from './color-picker.service';
let MccColorPickerComponent = class MccColorPickerComponent {
    constructor(elementRef, changeDetectorRef, colorPickerService, emptyColor) {
        this.elementRef = elementRef;
        this.changeDetectorRef = changeDetectorRef;
        this.colorPickerService = colorPickerService;
        this.emptyColor = emptyColor;
        this._usedColorLabel = 'Used Colors';
        this._reverseUsedColor = false;
        this._hideHexForms = false;
        this._hideEmpty = false;
        this._hideTransparent = false;
        this._hideUsedColors = false;
        this._isOpen = false;
        this._overlay = true;
        this._hideButtons = false;
        this._colorPickerSelectorHeight = 170;
        this._hideColorPickerSelector = false;
        /**
         * Set the size of the used colors
         */
        this.usedSizeColors = 30;
        /**
         * Change btnCancel label
         */
        this.btnCancel = 'Cancel';
        /**
         * Change btnConfirm label
         */
        this.btnConfirm = 'Confirm';
        /**
         * Event emitted when user change the selected color (without confirm)
         */
        this.change = new EventEmitter();
        /**
         * Event emitted when selected color is confirm
         */
        this.selected = new EventEmitter();
        /**
         * Event emitted when is clicked outside of the component
         */
        this.clickOut = new EventEmitter();
        /**
         * Array of subscriptions from the collections
         */
        this._collectionSubs = [];
    }
    /**
     * Change label of the collection UsedColors
     */
    get usedColorLabel() {
        return this._usedColorLabel;
    }
    set usedColorLabel(value) {
        this._usedColorLabel = value;
    }
    /**
     * Set initial value for used color
     */
    set usedColorStart(colors) {
        if (colors && colors.length > 0) {
            for (const color of colors) {
                this.colorPickerService.addColor(color);
            }
        }
    }
    /**
     * Set usedColor to be used in reverse
     */
    set reverseUsedColors(reverse) {
        this._reverseUsedColor = coerceBooleanProperty(reverse);
    }
    /**
     * Hide the hexadecimal color forms.
     */
    get hideHexForms() {
        return this._hideHexForms;
    }
    set hideHexForms(value) {
        this._hideHexForms = value;
    }
    /**
     * Hide empty slots from the collection UsedColors
     */
    get hideEmpty() {
        return this._hideEmpty;
    }
    set hideEmpty(value) {
        this._hideEmpty = coerceBooleanProperty(value);
    }
    /**
     * Hide transparent option of UsedColors
     */
    get hideTransparent() {
        return this._hideTransparent;
    }
    set hideTransparent(value) {
        this._hideTransparent = coerceBooleanProperty(value);
    }
    /**
     * Hide UsedColors collection
     */
    get hideUsedColors() {
        return this._hideUsedColors;
    }
    set hideUsedColors(value) {
        this._hideUsedColors = coerceBooleanProperty(value);
    }
    /**
     * Start with a color selected
     */
    get selectedColor() {
        return this._selectedColor;
    }
    set selectedColor(value) {
        if (this._selectedColor !== value) {
            this.changeDetectorRef.markForCheck();
        }
        this._selectedColor = coerceHexaColor(value) || this.emptyColor;
    }
    /**
     * Define if the panel will be initiated open
     */
    get isOpen() {
        return this._isOpen;
    }
    set isOpen(value) {
        this._isOpen = coerceBooleanProperty(value);
    }
    /**
     * Define if the panel will show in overlay or not
     */
    get overlay() {
        return this._overlay;
    }
    set overlay(value) {
        this._overlay = coerceBooleanProperty(value);
    }
    /**
     * Hide the action buttons (cancel/confirm)
     */
    get hideButtons() {
        return this._hideButtons;
    }
    set hideButtons(value) {
        this._hideButtons = coerceBooleanProperty(value);
    }
    /**
     * Define new height for the selector
     */
    get colorPickerSelectorHeight() {
        return this._colorPickerSelectorHeight;
    }
    set colorPickerSelectorHeight(height) {
        this._colorPickerSelectorHeight = height;
    }
    /**
     * Hide the color picker selector
     */
    get hideColorPickerSelector() {
        return this._hideColorPickerSelector;
    }
    set hideColorPickerSelector(value) {
        this._hideColorPickerSelector = coerceBooleanProperty(value);
    }
    /**
     * Return a Observable with the color the user is picking
     */
    get tmpSelectedColor$() {
        return this._tmpSelectedColor.asObservable();
    }
    /**
     * Observable with all the colors used by the user
     */
    get usedColors$() {
        return this.colorPickerService
            .getColors()
            .pipe(map(colors => (!this._reverseUsedColor ? colors : [...colors].reverse())));
    }
    ngOnInit() {
        if (!this._selectedColor) {
            this._selectedColor = this.emptyColor;
        }
        this._tmpSelectedColor = new BehaviorSubject(this._selectedColor);
    }
    /**
     * Walk throw all collections and subcribe to changes
     */
    ngAfterContentInit() {
        if (this._collections) {
            this._collections.forEach((collection) => {
                const subscription = collection.changeColor.subscribe(color => {
                    this.updateTmpSelectedColor(color);
                });
                this._collectionSubs.push(subscription);
            });
        }
    }
    /**
     * Destroy all subscriptions
     */
    ngOnDestroy() {
        if (this._collectionSubs) {
            this._collectionSubs.forEach((subscription) => {
                if (subscription && !subscription.closed) {
                    subscription.unsubscribe();
                }
            });
        }
    }
    /**
     * Update selected color and emit the change
     */
    _updateSelectedColor() {
        if (this._isOpen || !this.overlay) {
            const tmpSelectedColor = this._tmpSelectedColor.getValue();
            if (this._selectedColor !== tmpSelectedColor) {
                this._selectedColor = tmpSelectedColor;
                this.selected.next(this._selectedColor);
            }
            else {
                this.selected.emit(this._selectedColor);
            }
        }
    }
    /**
     * Open/close color picker panel
     */
    toggle() {
        this._isOpen = !this._isOpen;
        if (!this._isOpen && this._selectedColor !== this.emptyColor) {
            this.colorPickerService.addColor(this._selectedColor);
        }
    }
    /**
     * Update selected color, close the panel and notify the user
     */
    backdropClick() {
        if (this._hideButtons) {
            this.confirmSelectedColor();
        }
        else {
            this.cancelSelection();
        }
        this.clickOut.emit(null);
    }
    /**
     * Update tmpSelectedColor
     * @param color string
     */
    updateTmpSelectedColor(color) {
        if (color) {
            this._tmpSelectedColor.next(color);
            this.change.next(color);
            if (this._hideButtons) {
                this._updateSelectedColor();
            }
        }
    }
    /**
     * Cancel the selection and close the panel
     */
    cancelSelection() {
        this._tmpSelectedColor.next(this._selectedColor);
        this.toggle();
    }
    /**
     * Update selectedColor and close the panel
     */
    confirmSelectedColor() {
        this._updateSelectedColor();
        this.toggle();
    }
};
tslib_1.__decorate([
    ContentChildren(MccColorPickerCollectionComponent),
    tslib_1.__metadata("design:type", QueryList)
], MccColorPickerComponent.prototype, "_collections", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String),
    tslib_1.__metadata("design:paramtypes", [String])
], MccColorPickerComponent.prototype, "usedColorLabel", null);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Array),
    tslib_1.__metadata("design:paramtypes", [Array])
], MccColorPickerComponent.prototype, "usedColorStart", null);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Boolean),
    tslib_1.__metadata("design:paramtypes", [Boolean])
], MccColorPickerComponent.prototype, "reverseUsedColors", null);
tslib_1.__decorate([
    Input('hideHexForms'),
    tslib_1.__metadata("design:type", Boolean),
    tslib_1.__metadata("design:paramtypes", [Boolean])
], MccColorPickerComponent.prototype, "hideHexForms", null);
tslib_1.__decorate([
    Input('hideEmptyUsedColors'),
    tslib_1.__metadata("design:type", Boolean),
    tslib_1.__metadata("design:paramtypes", [Boolean])
], MccColorPickerComponent.prototype, "hideEmpty", null);
tslib_1.__decorate([
    Input('hideTransparentUsedColors'),
    tslib_1.__metadata("design:type", Boolean),
    tslib_1.__metadata("design:paramtypes", [Boolean])
], MccColorPickerComponent.prototype, "hideTransparent", null);
tslib_1.__decorate([
    Input('hideUsedColors'),
    tslib_1.__metadata("design:type", Boolean),
    tslib_1.__metadata("design:paramtypes", [Boolean])
], MccColorPickerComponent.prototype, "hideUsedColors", null);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String),
    tslib_1.__metadata("design:paramtypes", [String])
], MccColorPickerComponent.prototype, "selectedColor", null);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Boolean),
    tslib_1.__metadata("design:paramtypes", [Boolean])
], MccColorPickerComponent.prototype, "isOpen", null);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Boolean),
    tslib_1.__metadata("design:paramtypes", [Boolean])
], MccColorPickerComponent.prototype, "overlay", null);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Boolean),
    tslib_1.__metadata("design:paramtypes", [Boolean])
], MccColorPickerComponent.prototype, "hideButtons", null);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Number),
    tslib_1.__metadata("design:paramtypes", [Number])
], MccColorPickerComponent.prototype, "colorPickerSelectorHeight", null);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Boolean),
    tslib_1.__metadata("design:paramtypes", [Boolean])
], MccColorPickerComponent.prototype, "hideColorPickerSelector", null);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Number)
], MccColorPickerComponent.prototype, "usedSizeColors", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], MccColorPickerComponent.prototype, "btnCancel", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], MccColorPickerComponent.prototype, "btnConfirm", void 0);
tslib_1.__decorate([
    Output(),
    tslib_1.__metadata("design:type", Object)
], MccColorPickerComponent.prototype, "change", void 0);
tslib_1.__decorate([
    Output(),
    tslib_1.__metadata("design:type", Object)
], MccColorPickerComponent.prototype, "selected", void 0);
tslib_1.__decorate([
    Output(),
    tslib_1.__metadata("design:type", Object)
], MccColorPickerComponent.prototype, "clickOut", void 0);
MccColorPickerComponent = tslib_1.__decorate([
    Component({
        selector: 'mcc-color-picker',
        template: "<!-- color picker overlay -->\n<ng-container *ngIf=\"overlay\">\n    <button type=\"button\" class=\"btn-picker\" cdkOverlayOrigin #trigger=\"cdkOverlayOrigin\" [ngClass]=\"{ 'empty': selectedColor === emptyColor }\"\n        [style.background]=\"selectedColor\" (click)=\"toggle()\">\n        <div class=\"transparent\" *ngIf=\"selectedColor === emptyColor\"></div>\n    </button>\n\n    <ng-template cdkConnectedOverlay cdkConnectedOverlayHasBackdrop cdkConnectedOverlayBackdropClass=\"mcc-color-picker-backdrop\"\n        [cdkConnectedOverlayOrigin]=\"trigger\" [cdkConnectedOverlayOpen]=\"isOpen\" (backdropClick)=\"backdropClick()\">\n\n        <ng-template [cdkPortalOutlet]=\"overlayPanel\"></ng-template>\n\n    </ng-template>\n</ng-container>\n\n<!-- color picker flat -->\n<ng-template *ngIf=\"!overlay\" [cdkPortalOutlet]=\"overlayPanel\"></ng-template>\n\n<!-- color picker component content -->\n<ng-template cdkPortal #overlayPanel=\"cdkPortal\">\n\n    <div class=\"mcc-color-picker-overlay mat-elevation-z6\" role=\"dialog\" aria-label=\"Color picker\">\n\n        <mcc-color-picker-selector *ngIf=\"!hideColorPickerSelector\" [selectedColor]=\"tmpSelectedColor$ | async\" [hideHexForms]=\"hideHexForms\"\n            [height]=\"colorPickerSelectorHeight\" (changeSelectedColor)=\"updateTmpSelectedColor($event)\">\n        </mcc-color-picker-selector>\n\n        <mcc-color-picker-collection *ngIf=\"!hideUsedColors\" [label]=\"usedColorLabel\" [size]=\"usedSizeColors\" [transparent]=\"!hideTransparent\"\n            [hideEmpty]=\"hideEmpty\" [colors]=\"usedColors$ | async\" (changeColor)=\"updateTmpSelectedColor($event)\">\n        </mcc-color-picker-collection>\n\n        <ng-content></ng-content>\n\n        <div *ngIf=\"!hideButtons\" class=\"mcc-color-picker-actions\">\n\n            <button mat-button role=\"button\" aria-label=\"Cancel\" (click)=\"cancelSelection()\">\n                {{ btnCancel }}\n            </button>\n\n            <button mat-button role=\"button\" aria-label=\"Confirm\" (click)=\"confirmSelectedColor()\">\n                {{ btnConfirm }}\n            </button>\n\n        </div>\n\n    </div>\n\n</ng-template>",
        preserveWhitespaces: false,
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: ["@import url(https://fonts.googleapis.com/css?family=Open+Sans:400,700);.btn-picker{width:25px;height:25px;cursor:pointer;background:0 0;border:2px solid #ddd}.btn-picker.empty{background:#fff!important}.mcc-color-picker-overlay{display:flex;width:260px;min-height:80px;position:relative;flex-direction:column;padding:0;background:#fff;font-family:'Open Sans',sans-serif}.mcc-color-picker-overlay .mcc-color-picker-preview{width:100%;height:8px}.transparent{width:32px;height:2px;border-bottom:2px solid red;transform:translateY(-3px) translateX(-2px) rotate(45deg);-webkit-transform:translateY(-2px) translateX(-11px) rotate(45deg);position:absolute}.mcc-color-picker-actions{display:flex;padding:4px;border-top:1px solid #ddd}.mcc-color-picker-actions button{color:#100214;text-transform:uppercase;font-family:'Open Sans',sans-serif;font-size:12px;font-weight:400;flex-grow:1}"]
    }),
    tslib_1.__param(3, Inject(EMPTY_COLOR)),
    tslib_1.__metadata("design:paramtypes", [ElementRef,
        ChangeDetectorRef,
        MccColorPickerService, String])
], MccColorPickerComponent);
export { MccColorPickerComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3ItcGlja2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL21hdGVyaWFsLWNvbW11bml0eS1jb21wb25lbnRzLyIsInNvdXJjZXMiOlsiY29sb3ItcGlja2VyL2NvbG9yLXBpY2tlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzlELE9BQU8sRUFFTCx1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxlQUFlLEVBQ2YsVUFBVSxFQUNWLFlBQVksRUFDWixNQUFNLEVBQ04sS0FBSyxFQUdMLE1BQU0sRUFDTixTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGVBQWUsRUFBNEIsTUFBTSxNQUFNLENBQUM7QUFDakUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSxXQUFXLEVBQUUsZUFBZSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUQsT0FBTyxFQUFFLGlDQUFpQyxFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDeEYsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFTL0QsSUFBYSx1QkFBdUIsR0FBcEMsTUFBYSx1QkFBdUI7SUF3TmxDLFlBQ1UsVUFBc0IsRUFDdEIsaUJBQW9DLEVBQ3BDLGtCQUF5QyxFQUNyQixVQUFrQjtRQUh0QyxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUF1QjtRQUNyQixlQUFVLEdBQVYsVUFBVSxDQUFRO1FBM014QyxvQkFBZSxHQUFXLGFBQWEsQ0FBQztRQXFCeEMsc0JBQWlCLEdBQVksS0FBSyxDQUFDO1FBWW5DLGtCQUFhLEdBQVksS0FBSyxDQUFDO1FBWS9CLGVBQVUsR0FBWSxLQUFLLENB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QUdQO0FBU1E7SUFBUixLQUFLLEVBQUU7OytEQUE2QjtBQUs1QjtJQUFSLEtBQUssRUFBRTs7MERBQThCO0FBSzdCO0lBQVIsS0FBSyxFQUFFOzsyREFBZ0M7QUFLOUI7SUFBVCxNQUFNLEVBQUU7O3VEQUE2QjtBQUs1QjtJQUFULE1BQU0sRUFBRTs7eURBQStCO0FBSzlCO0lBQVQsTUFBTSxFQUFFOzt5REFBK0I7QUFoTTdCLHVCQUF1QjtJQVBuQyxTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsa0JBQWtCO1FBQzVCLHVvRUFBNEM7UUFFNUMsbUJBQW1CLEVBQUUsS0FBSztRQUMxQixlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTs7S0FDaEQsQ0FBQztJQTZORyxtQkFBQSxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUE7NkNBSEEsVUFBVTtRQUNILGlCQUFpQjtRQUNoQixxQkFBcUI7R0EzTnhDLHVCQUF1QixDQXFVbkM7U0FyVVksdUJBQXVCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29lcmNlQm9vbGVhblByb3BlcnR5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvZXJjaW9uJztcbmltcG9ydCB7XG4gIEFmdGVyQ29udGVudEluaXQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5qZWN0LFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgUXVlcnlMaXN0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBFTVBUWV9DT0xPUiwgY29lcmNlSGV4YUNvbG9yIH0gZnJvbSAnLi9jb2xvci1waWNrZXInO1xuaW1wb3J0IHsgTWNjQ29sb3JQaWNrZXJDb2xsZWN0aW9uQ29tcG9uZW50IH0gZnJvbSAnLi9jb2xvci1waWNrZXItY29sbGVjdGlvbi5jb21wb25lbnQnO1xuaW1wb3J0IHsgTWNjQ29sb3JQaWNrZXJTZXJ2aWNlIH0gZnJvbSAnLi9jb2xvci1waWNrZXIuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ21jYy1jb2xvci1waWNrZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vY29sb3ItcGlja2VyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vY29sb3ItcGlja2VyLmNvbXBvbmVudC5zY3NzJ10sXG4gIHByZXNlcnZlV2hpdGVzcGFjZXM6IGZhbHNlLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgTWNjQ29sb3JQaWNrZXJDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRJbml0LCBPbkluaXQsIE9uRGVzdHJveSB7XG4gIC8qKlxuICAgKiBHZXQgYWxsIGNvbGxlY3Rpb25zXG4gICAqL1xuICBAQ29udGVudENoaWxkcmVuKE1jY0NvbG9yUGlja2VyQ29sbGVjdGlvbkNvbXBvbmVudClcbiAgX2NvbGxlY3Rpb25zOiBRdWVyeUxpc3Q8TWNjQ29sb3JQaWNrZXJDb2xsZWN0aW9uQ29tcG9uZW50PjtcblxuICAvKipcbiAgICogQ2hhbmdlIGxhYmVsIG9mIHRoZSBjb2xsZWN0aW9uIFVzZWRDb2xvcnNcbiAgICovXG4gIEBJbnB1dCgpXG4gIGdldCB1c2VkQ29sb3JMYWJlbCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLl91c2VkQ29sb3JMYWJlbDtcbiAgfVxuICBzZXQgdXNlZENvbG9yTGFiZWwodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMuX3VzZWRDb2xvckxhYmVsID0gdmFsdWU7XG4gIH1cbiAgcHJpdmF0ZSBfdXNlZENvbG9yTGFiZWw6IHN0cmluZyA9ICdVc2VkIENvbG9ycyc7XG5cbiAgLyoqXG4gICAqIFNldCBpbml0aWFsIHZhbHVlIGZvciB1c2VkIGNvbG9yXG4gICAqL1xuICBASW5wdXQoKVxuICBzZXQgdXNlZENvbG9yU3RhcnQoY29sb3JzOiBzdHJpbmdbXSkge1xuICAgIGlmIChjb2xvcnMgJiYgY29sb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAoY29uc3QgY29sb3Igb2YgY29sb3JzKSB7XG4gICAgICAgIHRoaXMuY29sb3JQaWNrZXJTZXJ2aWNlLmFkZENvbG9yKGNvbG9yKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHVzZWRDb2xvciB0byBiZSB1c2VkIGluIHJldmVyc2VcbiAgICovXG4gIEBJbnB1dCgpXG4gIHNldCByZXZlcnNlVXNlZENvbG9ycyhyZXZlcnNlOiBib29sZWFuKSB7XG4gICAgdGhpcy5fcmV2ZXJzZVVzZWRDb2xvciA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eShyZXZlcnNlKTtcbiAgfVxuICBwcml2YXRlIF9yZXZlcnNlVXNlZENvbG9yOiBib29sZWFuID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEhpZGUgdGhlIGhleGFkZWNpbWFsIGNvbG9yIGZvcm1zLlxuICAgKi9cbiAgQElucHV0KCdoaWRlSGV4Rm9ybXMnKVxuICBnZXQgaGlkZUhleEZvcm1zKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9oaWRlSGV4Rm9ybXM7XG4gIH1cbiAgc2V0IGhpZGVIZXhGb3Jtcyh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2hpZGVIZXhGb3JtcyA9IHZhbHVlO1xuICB9XG4gIHByaXZhdGUgX2hpZGVIZXhGb3JtczogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBIaWRlIGVtcHR5IHNsb3RzIGZyb20gdGhlIGNvbGxlY3Rpb24gVXNlZENvbG9yc1xuICAgKi9cbiAgQElucHV0KCdoaWRlRW1wdHlVc2VkQ29sb3JzJylcbiAgZ2V0IGhpZGVFbXB0eSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5faGlkZUVtcHR5O1xuICB9XG4gIHNldCBoaWRlRW1wdHkodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9oaWRlRW1wdHkgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodmFsdWUpO1xuICB9XG4gIHByaXZhdGUgX2hpZGVFbXB0eTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBIaWRlIHRyYW5zcGFyZW50IG9wdGlvbiBvZiBVc2VkQ29sb3JzXG4gICAqL1xuICBASW5wdXQoJ2hpZGVUcmFuc3BhcmVudFVzZWRDb2xvcnMnKVxuICBnZXQgaGlkZVRyYW5zcGFyZW50KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9oaWRlVHJhbnNwYXJlbnQ7XG4gIH1cbiAgc2V0IGhpZGVUcmFuc3BhcmVudCh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2hpZGVUcmFuc3BhcmVudCA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSh2YWx1ZSk7XG4gIH1cbiAgcHJpdmF0ZSBfaGlkZVRyYW5zcGFyZW50OiBib29sZWFuID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEhpZGUgVXNlZENvbG9ycyBjb2xsZWN0aW9uXG4gICAqL1xuICBASW5wdXQoJ2hpZGVVc2VkQ29sb3JzJylcbiAgZ2V0IGhpZGVVc2VkQ29sb3JzKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9oaWRlVXNlZENvbG9ycztcbiAgfVxuICBzZXQgaGlkZVVzZWRDb2xvcnModmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9oaWRlVXNlZENvbG9ycyA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSh2YWx1ZSk7XG4gIH1cbiAgcHJpdmF0ZSBfaGlkZVVzZWRDb2xvcnM6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAvKipcbiAgICogU3RhcnQgd2l0aCBhIGNvbG9yIHNlbGVjdGVkXG4gICAqL1xuICBASW5wdXQoKVxuICBnZXQgc2VsZWN0ZWRDb2xvcigpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLl9zZWxlY3RlZENvbG9yO1xuICB9XG4gIHNldCBzZWxlY3RlZENvbG9yKHZhbHVlOiBzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5fc2VsZWN0ZWRDb2xvciAhPT0gdmFsdWUpIHtcbiAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuXG4gICAgdGhpcy5fc2VsZWN0ZWRDb2xvciA9IGNvZXJjZUhleGFDb2xvcih2YWx1ZSkgfHwgdGhpcy5lbXB0eUNvbG9yO1xuICB9XG4gIHByaXZhdGUgX3NlbGVjdGVkQ29sb3I6IHN0cmluZztcblxuICAvKipcbiAgICogRGVmaW5lIGlmIHRoZSBwYW5lbCB3aWxsIGJlIGluaXRpYXRlZCBvcGVuXG4gICAqL1xuICBASW5wdXQoKVxuICBnZXQgaXNPcGVuKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9pc09wZW47XG4gIH1cbiAgc2V0IGlzT3Blbih2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2lzT3BlbiA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSh2YWx1ZSk7XG4gIH1cbiAgcHJpdmF0ZSBfaXNPcGVuOiBib29sZWFuID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIERlZmluZSBpZiB0aGUgcGFuZWwgd2lsbCBzaG93IGluIG92ZXJsYXkgb3Igbm90XG4gICAqL1xuICBASW5wdXQoKVxuICBnZXQgb3ZlcmxheSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fb3ZlcmxheTtcbiAgfVxuICBzZXQgb3ZlcmxheSh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX292ZXJsYXkgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodmFsdWUpO1xuICB9XG4gIHByaXZhdGUgX292ZXJsYXk6IGJvb2xlYW4gPSB0cnVlO1xuXG4gIC8qKlxuICAgKiBIaWRlIHRoZSBhY3Rpb24gYnV0dG9ucyAoY2FuY2VsL2NvbmZpcm0pXG4gICAqL1xuICBASW5wdXQoKVxuICBnZXQgaGlkZUJ1dHRvbnMoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2hpZGVCdXR0b25zO1xuICB9XG4gIHNldCBoaWRlQnV0dG9ucyh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2hpZGVCdXR0b25zID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcbiAgfVxuICBwcml2YXRlIF9oaWRlQnV0dG9uczogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBEZWZpbmUgbmV3IGhlaWdodCBmb3IgdGhlIHNlbGVjdG9yXG4gICAqL1xuICBASW5wdXQoKVxuICBnZXQgY29sb3JQaWNrZXJTZWxlY3RvckhlaWdodCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl9jb2xvclBpY2tlclNlbGVjdG9ySGVpZ2h0O1xuICB9XG4gIHNldCBjb2xvclBpY2tlclNlbGVjdG9ySGVpZ2h0KGhlaWdodDogbnVtYmVyKSB7XG4gICAgdGhpcy5fY29sb3JQaWNrZXJTZWxlY3RvckhlaWdodCA9IGhlaWdodDtcbiAgfVxuICBwcml2YXRlIF9jb2xvclBpY2tlclNlbGVjdG9ySGVpZ2h0OiBudW1iZXIgPSAxNzA7XG5cbiAgLyoqXG4gICAqIEhpZGUgdGhlIGNvbG9yIHBpY2tlciBzZWxlY3RvclxuICAgKi9cbiAgQElucHV0KClcbiAgZ2V0IGhpZGVDb2xvclBpY2tlclNlbGVjdG9yKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9oaWRlQ29sb3JQaWNrZXJTZWxlY3RvcjtcbiAgfVxuICBzZXQgaGlkZUNvbG9yUGlja2VyU2VsZWN0b3IodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9oaWRlQ29sb3JQaWNrZXJTZWxlY3RvciA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSh2YWx1ZSk7XG4gIH1cbiAgcHJpdmF0ZSBfaGlkZUNvbG9yUGlja2VyU2VsZWN0b3I6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAvKipcbiAgICogU2V0IHRoZSBzaXplIG9mIHRoZSB1c2VkIGNvbG9yc1xuICAgKi9cbiAgQElucHV0KCkgdXNlZFNpemVDb2xvcnM6IG51bWJlciA9IDMwO1xuXG4gIC8qKlxuICAgKiBDaGFuZ2UgYnRuQ2FuY2VsIGxhYmVsXG4gICAqL1xuICBASW5wdXQoKSBidG5DYW5jZWw6IHN0cmluZyA9ICdDYW5jZWwnO1xuXG4gIC8qKlxuICAgKiBDaGFuZ2UgYnRuQ29uZmlybSBsYWJlbFxuICAgKi9cbiAgQElucHV0KCkgYnRuQ29uZmlybTogc3RyaW5nID0gJ0NvbmZpcm0nO1xuXG4gIC8qKlxuICAgKiBFdmVudCBlbWl0dGVkIHdoZW4gdXNlciBjaGFuZ2UgdGhlIHNlbGVjdGVkIGNvbG9yICh3aXRob3V0IGNvbmZpcm0pXG4gICAqL1xuICBAT3V0cHV0KCkgY2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8qKlxuICAgKiBFdmVudCBlbWl0dGVkIHdoZW4gc2VsZWN0ZWQgY29sb3IgaXMgY29uZmlybVxuICAgKi9cbiAgQE91dHB1dCgpIHNlbGVjdGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8qKlxuICAgKiBFdmVudCBlbWl0dGVkIHdoZW4gaXMgY2xpY2tlZCBvdXRzaWRlIG9mIHRoZSBjb21wb25lbnRcbiAgICovXG4gIEBPdXRwdXQoKSBjbGlja091dCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAvKipcbiAgICogUmV0dXJuIGEgT2JzZXJ2YWJsZSB3aXRoIHRoZSBjb2xvciB0aGUgdXNlciBpcyBwaWNraW5nXG4gICAqL1xuICBnZXQgdG1wU2VsZWN0ZWRDb2xvciQoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gdGhpcy5fdG1wU2VsZWN0ZWRDb2xvci5hc09ic2VydmFibGUoKTtcbiAgfVxuICBwcml2YXRlIF90bXBTZWxlY3RlZENvbG9yOiBCZWhhdmlvclN1YmplY3Q8c3RyaW5nPjtcblxuICAvKipcbiAgICogT2JzZXJ2YWJsZSB3aXRoIGFsbCB0aGUgY29sb3JzIHVzZWQgYnkgdGhlIHVzZXJcbiAgICovXG4gIGdldCB1c2VkQ29sb3JzJCgpOiBPYnNlcnZhYmxlPHN0cmluZ1tdPiB7XG4gICAgcmV0dXJuIHRoaXMuY29sb3JQaWNrZXJTZXJ2aWNlXG4gICAgICAuZ2V0Q29sb3JzKClcbiAgICAgIC5waXBlKG1hcChjb2xvcnMgPT4gKCF0aGlzLl9yZXZlcnNlVXNlZENvbG9yID8gY29sb3JzIDogWy4uLmNvbG9yc10ucmV2ZXJzZSgpKSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFycmF5IG9mIHN1YnNjcmlwdGlvbnMgZnJvbSB0aGUgY29sbGVjdGlvbnNcbiAgICovXG4gIHByaXZhdGUgX2NvbGxlY3Rpb25TdWJzOiBTdWJzY3JpcHRpb25bXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIGNvbG9yUGlja2VyU2VydmljZTogTWNjQ29sb3JQaWNrZXJTZXJ2aWNlLFxuICAgIEBJbmplY3QoRU1QVFlfQ09MT1IpIHB1YmxpYyBlbXB0eUNvbG9yOiBzdHJpbmdcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGlmICghdGhpcy5fc2VsZWN0ZWRDb2xvcikge1xuICAgICAgdGhpcy5fc2VsZWN0ZWRDb2xvciA9IHRoaXMuZW1wdHlDb2xvcjtcbiAgICB9XG5cbiAgICB0aGlzLl90bXBTZWxlY3RlZENvbG9yID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+KHRoaXMuX3NlbGVjdGVkQ29sb3IpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdhbGsgdGhyb3cgYWxsIGNvbGxlY3Rpb25zIGFuZCBzdWJjcmliZSB0byBjaGFuZ2VzXG4gICAqL1xuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgaWYgKHRoaXMuX2NvbGxlY3Rpb25zKSB7XG4gICAgICB0aGlzLl9jb2xsZWN0aW9ucy5mb3JFYWNoKChjb2xsZWN0aW9uOiBNY2NDb2xvclBpY2tlckNvbGxlY3Rpb25Db21wb25lbnQpID0+IHtcbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gY29sbGVjdGlvbi5jaGFuZ2VDb2xvci5zdWJzY3JpYmUoY29sb3IgPT4ge1xuICAgICAgICAgIHRoaXMudXBkYXRlVG1wU2VsZWN0ZWRDb2xvcihjb2xvcik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuX2NvbGxlY3Rpb25TdWJzLnB1c2goc3Vic2NyaXB0aW9uKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEZXN0cm95IGFsbCBzdWJzY3JpcHRpb25zXG4gICAqL1xuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5fY29sbGVjdGlvblN1YnMpIHtcbiAgICAgIHRoaXMuX2NvbGxlY3Rpb25TdWJzLmZvckVhY2goKHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uKSA9PiB7XG4gICAgICAgIGlmIChzdWJzY3JpcHRpb24gJiYgIXN1YnNjcmlwdGlvbi5jbG9zZWQpIHtcbiAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBzZWxlY3RlZCBjb2xvciBhbmQgZW1pdCB0aGUgY2hhbmdlXG4gICAqL1xuICBwcml2YXRlIF91cGRhdGVTZWxlY3RlZENvbG9yKCkge1xuICAgIGlmICh0aGlzLl9pc09wZW4gfHwgIXRoaXMub3ZlcmxheSkge1xuICAgICAgY29uc3QgdG1wU2VsZWN0ZWRDb2xvciA9IHRoaXMuX3RtcFNlbGVjdGVkQ29sb3IuZ2V0VmFsdWUoKTtcbiAgICAgIGlmICh0aGlzLl9zZWxlY3RlZENvbG9yICE9PSB0bXBTZWxlY3RlZENvbG9yKSB7XG4gICAgICAgIHRoaXMuX3NlbGVjdGVkQ29sb3IgPSB0bXBTZWxlY3RlZENvbG9yO1xuICAgICAgICB0aGlzLnNlbGVjdGVkLm5leHQodGhpcy5fc2VsZWN0ZWRDb2xvcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNlbGVjdGVkLmVtaXQodGhpcy5fc2VsZWN0ZWRDb2xvcik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE9wZW4vY2xvc2UgY29sb3IgcGlja2VyIHBhbmVsXG4gICAqL1xuICB0b2dnbGUoKSB7XG4gICAgdGhpcy5faXNPcGVuID0gIXRoaXMuX2lzT3BlbjtcbiAgICBpZiAoIXRoaXMuX2lzT3BlbiAmJiB0aGlzLl9zZWxlY3RlZENvbG9yICE9PSB0aGlzLmVtcHR5Q29sb3IpIHtcbiAgICAgIHRoaXMuY29sb3JQaWNrZXJTZXJ2aWNlLmFkZENvbG9yKHRoaXMuX3NlbGVjdGVkQ29sb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgc2VsZWN0ZWQgY29sb3IsIGNsb3NlIHRoZSBwYW5lbCBhbmQgbm90aWZ5IHRoZSB1c2VyXG4gICAqL1xuICBiYWNrZHJvcENsaWNrKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLl9oaWRlQnV0dG9ucykge1xuICAgICAgdGhpcy5jb25maXJtU2VsZWN0ZWRDb2xvcigpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNhbmNlbFNlbGVjdGlvbigpO1xuICAgIH1cbiAgICB0aGlzLmNsaWNrT3V0LmVtaXQobnVsbCk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRtcFNlbGVjdGVkQ29sb3JcbiAgICogQHBhcmFtIGNvbG9yIHN0cmluZ1xuICAgKi9cbiAgdXBkYXRlVG1wU2VsZWN0ZWRDb2xvcihjb2xvcjogc3RyaW5nKSB7XG4gICAgaWYgKGNvbG9yKSB7XG4gICAgICB0aGlzLl90bXBTZWxlY3RlZENvbG9yLm5leHQoY29sb3IpO1xuICAgICAgdGhpcy5jaGFuZ2UubmV4dChjb2xvcik7XG4gICAgICBpZiAodGhpcy5faGlkZUJ1dHRvbnMpIHtcbiAgICAgICAgdGhpcy5fdXBkYXRlU2VsZWN0ZWRDb2xvcigpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYW5jZWwgdGhlIHNlbGVjdGlvbiBhbmQgY2xvc2UgdGhlIHBhbmVsXG4gICAqL1xuICBjYW5jZWxTZWxlY3Rpb24oKSB7XG4gICAgdGhpcy5fdG1wU2VsZWN0ZWRDb2xvci5uZXh0KHRoaXMuX3NlbGVjdGVkQ29sb3IpO1xuICAgIHRoaXMudG9nZ2xlKCk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHNlbGVjdGVkQ29sb3IgYW5kIGNsb3NlIHRoZSBwYW5lbFxuICAgKi9cbiAgY29uZmlybVNlbGVjdGVkQ29sb3IoKSB7XG4gICAgdGhpcy5fdXBkYXRlU2VsZWN0ZWRDb2xvcigpO1xuICAgIHRoaXMudG9nZ2xlKCk7XG4gIH1cbn1cbiJdfQ==