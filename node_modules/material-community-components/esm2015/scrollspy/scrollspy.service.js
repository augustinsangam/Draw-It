import * as tslib_1 from "tslib";
import { Injectable, Inject } from '@angular/core';
import { SCROLLSPY_ANIMATION_SMOOTH } from './scrollspy';
import { BehaviorSubject, fromEvent } from 'rxjs';
import { debounceTime, withLatestFrom } from 'rxjs/operators';
let MccScrollspyService = class MccScrollspyService {
    constructor(window) {
        this.window = window;
        /**
         * When scroll is from click event, change this attr to true
         * So scroll event obeservable doesn't emit any update
         */
        this._fromClick = false;
        /**
         * List of scrollspy group
         */
        this.data = [];
        // listen to scroll event
        this._scrollSub = fromEvent(window, 'scroll')
            .pipe(debounceTime(50), withLatestFrom(() => window.scrollY))
            .subscribe(position => {
            if (!this._fromClick) {
                this._updateFocused(position);
            }
            this._fromClick = false;
        });
    }
    ngOnDestroy() {
        if (this._scrollSub && !this._scrollSub.closed) {
            this._scrollSub.unsubscribe();
        }
    }
    /**
     * Update information about wich element is on focus
     * @param position number
     */
    _updateFocused(position) {
        this.data.forEach(group => {
            const items = [];
            group.items.getValue().forEach((item, index) => {
                item.focus = false;
                if (item.top <= position) {
                    if (items[index - 1]) {
                        items[index - 1].focus = false;
                    }
                    item.focus = true;
                }
                items.push(item);
            });
            group.items.next(items);
        });
    }
    /**
     * Create new group of items
     * @param name string
     * @param items MccScrollspyItemDirective[]
     * @param animation ScrollBehavior
     */
    create(name, items, animation) {
        let group = this.data.find(group => group.name === name);
        if (!group) {
            group = {
                name: name,
                animation: animation || SCROLLSPY_ANIMATION_SMOOTH,
                items: new BehaviorSubject(items || []),
            };
            this.data.push(group);
        }
        else {
            group.items.next(items || []);
        }
        return group;
    }
    /**
     * Return observable of the group
     * @param name string
     */
    group(name) {
        let group = this.data.find(g => g.name === name);
        if (!group) {
            group = this.create(name);
        }
        return group.items.asObservable();
    }
    /**
     * Scroll to one of the items
     * @param name string
     * @param id string
     */
    scrollTo(name, id) {
        const group = this.data.find(group => group.name === name);
        group.items.getValue().forEach(item => {
            item.focus = false;
            if (item.id === id) {
                this._fromClick = true;
                this._updateFocused(item.top);
                window.scrollTo({ top: item.top, behavior: group.animation });
            }
        });
    }
};
MccScrollspyService = tslib_1.__decorate([
    Injectable(),
    tslib_1.__param(0, Inject('Window')),
    tslib_1.__metadata("design:paramtypes", [Object])
], MccScrollspyService);
export { MccScrollspyService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsc3B5LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9tYXRlcmlhbC1jb21tdW5pdHktY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbInNjcm9sbHNweS9zY3JvbGxzcHkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFFOUQsT0FBTyxFQUFxQiwwQkFBMEIsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUM1RSxPQUFPLEVBQTRCLGVBQWUsRUFBRSxTQUFTLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDNUUsT0FBTyxFQUFFLFlBQVksRUFBRSxjQUFjLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUc5RCxJQUFhLG1CQUFtQixHQUFoQyxNQUFhLG1CQUFtQjtJQWlCOUIsWUFBc0MsTUFBVztRQUFYLFdBQU0sR0FBTixNQUFNLENBQUs7UUFoQmpEOzs7V0FHRztRQUNLLGVBQVUsR0FBWSxLQUFLLENBQUM7UUFFcEM7O1dBRUc7UUFDSyxTQUFJLEdBQXdCLEVBQUUsQ0FBQztRQVFyQyx5QkFBeUI7UUFDekIsSUFBSSxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQzthQUMxQyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxFQUFFLGNBQWMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7YUFDNUQsU0FBUyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ3BCLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFO2dCQUNwQixJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQy9CO1lBQ0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7UUFDMUIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsV0FBVztRQUNULElBQUksSUFBSSxDQUFDLFVBQVUsSUFBSSxD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QyxDQUFDO2dCQUM5QixNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDO2FBQy9EO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0YsQ0FBQTtBQXBIWSxtQkFBbUI7SUFEL0IsVUFBVSxFQUFFO0lBa0JFLG1CQUFBLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQTs7R0FqQmxCLG1CQUFtQixDQW9IL0I7U0FwSFksbUJBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0LCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1jY1Njcm9sbHNweUl0ZW1EaXJlY3RpdmUgfSBmcm9tICcuL3Njcm9sbHNweS5kaXJlY3RpdmVzJztcbmltcG9ydCB7IE1jY1Njcm9sbHNweUdyb3VwLCBTQ1JPTExTUFlfQU5JTUFUSU9OX1NNT09USCB9IGZyb20gJy4vc2Nyb2xsc3B5JztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiwgT2JzZXJ2YWJsZSwgQmVoYXZpb3JTdWJqZWN0LCBmcm9tRXZlbnQgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgd2l0aExhdGVzdEZyb20gfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBNY2NTY3JvbGxzcHlTZXJ2aWNlIGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgLyoqXG4gICAqIFdoZW4gc2Nyb2xsIGlzIGZyb20gY2xpY2sgZXZlbnQsIGNoYW5nZSB0aGlzIGF0dHIgdG8gdHJ1ZVxuICAgKiBTbyBzY3JvbGwgZXZlbnQgb2Jlc2VydmFibGUgZG9lc24ndCBlbWl0IGFueSB1cGRhdGVcbiAgICovXG4gIHByaXZhdGUgX2Zyb21DbGljazogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBMaXN0IG9mIHNjcm9sbHNweSBncm91cFxuICAgKi9cbiAgcHJpdmF0ZSBkYXRhOiBNY2NTY3JvbGxzcHlHcm91cFtdID0gW107XG5cbiAgLyoqXG4gICAqIFNjcm9sbCBldmVudCBzdWJzY3JpcHRpb25cbiAgICovXG4gIHByaXZhdGUgX3Njcm9sbFN1YjogU3Vic2NyaXB0aW9uO1xuXG4gIGNvbnN0cnVjdG9yKEBJbmplY3QoJ1dpbmRvdycpIHByaXZhdGUgd2luZG93OiBhbnkpIHtcbiAgICAvLyBsaXN0ZW4gdG8gc2Nyb2xsIGV2ZW50XG4gICAgdGhpcy5fc2Nyb2xsU3ViID0gZnJvbUV2ZW50KHdpbmRvdywgJ3Njcm9sbCcpXG4gICAgICAucGlwZShkZWJvdW5jZVRpbWUoNTApLCB3aXRoTGF0ZXN0RnJvbSgoKSA9PiB3aW5kb3cuc2Nyb2xsWSkpXG4gICAgICAuc3Vic2NyaWJlKHBvc2l0aW9uID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLl9mcm9tQ2xpY2spIHtcbiAgICAgICAgICB0aGlzLl91cGRhdGVGb2N1c2VkKHBvc2l0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9mcm9tQ2xpY2sgPSBmYWxzZTtcbiAgICAgIH0pO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuX3Njcm9sbFN1YiAmJiAhdGhpcy5fc2Nyb2xsU3ViLmNsb3NlZCkge1xuICAgICAgdGhpcy5fc2Nyb2xsU3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBpbmZvcm1hdGlvbiBhYm91dCB3aWNoIGVsZW1lbnQgaXMgb24gZm9jdXNcbiAgICogQHBhcmFtIHBvc2l0aW9uIG51bWJlclxuICAgKi9cbiAgcHJpdmF0ZSBfdXBkYXRlRm9jdXNlZChwb3NpdGlvbjogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5kYXRhLmZvckVhY2goZ3JvdXAgPT4ge1xuICAgICAgY29uc3QgaXRlbXMgPSBbXTtcbiAgICAgIGdyb3VwLml0ZW1zLmdldFZhbHVlKCkuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcbiAgICAgICAgaXRlbS5mb2N1cyA9IGZhbHNlO1xuICAgICAgICBpZiAoaXRlbS50b3AgPD0gcG9zaXRpb24pIHtcbiAgICAgICAgICBpZiAoaXRlbXNbaW5kZXggLSAxXSkge1xuICAgICAgICAgICAgaXRlbXNbaW5kZXggLSAxXS5mb2N1cyA9IGZhbHNlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGl0ZW0uZm9jdXMgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaXRlbXMucHVzaChpdGVtKTtcbiAgICAgIH0pO1xuXG4gICAgICBncm91cC5pdGVtcy5uZXh0KGl0ZW1zKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgbmV3IGdyb3VwIG9mIGl0ZW1zXG4gICAqIEBwYXJhbSBuYW1lIHN0cmluZ1xuICAgKiBAcGFyYW0gaXRlbXMgTWNjU2Nyb2xsc3B5SXRlbURpcmVjdGl2ZVtdXG4gICAqIEBwYXJhbSBhbmltYXRpb24gU2Nyb2xsQmVoYXZpb3JcbiAgICovXG4gIGNyZWF0ZShcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgaXRlbXM/OiBNY2NTY3JvbGxzcHlJdGVtRGlyZWN0aXZlW10sXG4gICAgYW5pbWF0aW9uPzogU2Nyb2xsQmVoYXZpb3JcbiAgKTogTWNjU2Nyb2xsc3B5R3JvdXAge1xuICAgIGxldCBncm91cDogTWNjU2Nyb2xsc3B5R3JvdXAgPSB0aGlzLmRhdGEuZmluZChncm91cCA9PiBncm91cC5uYW1lID09PSBuYW1lKTtcbiAgICBpZiAoIWdyb3VwKSB7XG4gICAgICBncm91cCA9IHtcbiAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgYW5pbWF0aW9uOiBhbmltYXRpb24gfHwgU0NST0xMU1BZX0FOSU1BVElPTl9TTU9PVEgsXG4gICAgICAgIGl0ZW1zOiBuZXcgQmVoYXZpb3JTdWJqZWN0PE1jY1Njcm9sbHNweUl0ZW1EaXJlY3RpdmVbXT4oaXRlbXMgfHwgW10pLFxuICAgICAgfTtcblxuICAgICAgdGhpcy5kYXRhLnB1c2goZ3JvdXApO1xuICAgIH0gZWxzZSB7XG4gICAgICBncm91cC5pdGVtcy5uZXh0KGl0ZW1zIHx8IFtdKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZ3JvdXA7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIG9ic2VydmFibGUgb2YgdGhlIGdyb3VwXG4gICAqIEBwYXJhbSBuYW1lIHN0cmluZ1xuICAgKi9cbiAgZ3JvdXAobmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxNY2NTY3JvbGxzcHlJdGVtRGlyZWN0aXZlW10+IHtcbiAgICBsZXQgZ3JvdXA6IE1jY1Njcm9sbHNweUdyb3VwID0gdGhpcy5kYXRhLmZpbmQoZyA9PiBnLm5hbWUgPT09IG5hbWUpO1xuICAgIGlmICghZ3JvdXApIHtcbiAgICAgIGdyb3VwID0gdGhpcy5jcmVhdGUobmFtZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGdyb3VwLml0ZW1zLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNjcm9sbCB0byBvbmUgb2YgdGhlIGl0ZW1zXG4gICAqIEBwYXJhbSBuYW1lIHN0cmluZ1xuICAgKiBAcGFyYW0gaWQgc3RyaW5nXG4gICAqL1xuICBzY3JvbGxUbyhuYW1lOiBzdHJpbmcsIGlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBncm91cDogTWNjU2Nyb2xsc3B5R3JvdXAgPSB0aGlzLmRhdGEuZmluZChncm91cCA9PiBncm91cC5uYW1lID09PSBuYW1lKTtcblxuICAgIGdyb3VwLml0ZW1zLmdldFZhbHVlKCkuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgIGl0ZW0uZm9jdXMgPSBmYWxzZTtcbiAgICAgIGlmIChpdGVtLmlkID09PSBpZCkge1xuICAgICAgICB0aGlzLl9mcm9tQ2xpY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLl91cGRhdGVGb2N1c2VkKGl0ZW0udG9wKTtcbiAgICAgICAgd2luZG93LnNjcm9sbFRvKHsgdG9wOiBpdGVtLnRvcCwgYmVoYXZpb3I6IGdyb3VwLmFuaW1hdGlvbiB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuIl19